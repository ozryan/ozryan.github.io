<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title> - elasticsearch分布式搜索引擎</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">

          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy" crossorigin="anonymous"></script>
              
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
                  onload="renderMathInElement(document.body);"></script>
              
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;site.css">
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Even</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.fewth.com">Even</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/#1-elasticsearchshi-shi-yao" class="toc-link">1 elasticsearch是什么</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/#2-yun-xing-es" class="toc-link">2 运行es</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/#2-1-yun-xing-serverduan" class="toc-link">2.1 运行server端</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/#2-2-yun-xing-client" class="toc-link">2.2 运行client</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/#3-zai-javaxiang-mu-zhong-shi-yong-es" class="toc-link">3 在java项目中使用es</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/#3-1-java-high-level-rest-client" class="toc-link">3.1 Java High Level REST Client</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/#3-2-spring-data-elasticsearch" class="toc-link">3.2 spring-data-elasticsearch</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;elasticsearchfen-bu-shi-sou-suo-yin-qing&#x2F;">elasticsearch分布式搜索引擎</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2021-04-27</span>
            
        </div>
    </header>

    <div class="post-content">
      <h2 id="1-elasticsearchshi-shi-yao">1 elasticsearch是什么</h2>
<p>es是一个分布式的搜索和分析数据的引擎。es是基于<code>Apache Lucene</code>开发的，<code>Apache Lucene</code>库提供了很多API，但是偏底层，没有进行封装的话在项目中直接使用是很不方便的。</p>
<p>es本身可以存储和读取数据，那么跟数据库有什么不同呢？</br></p>
<!--more-->
<p>这里有个概念叫反向索引(也叫倒排索引)，英文是<a href="https://en.wikipedia.org/wiki/Inverted_index"><strong>Inverted Index</strong></a>，<strong>全文搜索</strong>和搜索引擎技术都依赖于这种数据结构。常规的数据库采用的是与之对应的<code>Forward Index</code>。</br>
比如，常见的技术书籍，通常在最后几页会有一个索引表，可以让你快速定位到某个名词对应的内容在第几页，这就是反向索引。而整本书的编排就像正向索引，你可以快速翻到某一页知道上面是什么内容。这两种索引技术是互补的，一本书如果根据索引表来编写，就显得没有逻辑，同样，缺少了索引表，作为工具书查询的时候效率也很低下。</br>
再举个例子，搜索引擎的运作也依赖反向索引，当你输入一个关键字进行搜索时，它不可能把整个网络世界的所有网页都搜一遍，从技术上来说这也不现实。一般来说，搜索引擎会利用爬虫不断的收集网络中的信息，给其中出现的关键字添加记录，指明这些关键字分别在哪些网页中出现了，当你搜索这些关键字的时候，对应的网页记录就显示出来了。当然，搜索引擎具体的工作方式还有很多影响因素，可以参考<code>Goolge</code>的科普专题：<a href="https://www.google.com/search/howsearchworks/">How Google Search works</a>。</br>
通过比较可以发现，数据库更偏向于存储数据，而反向索引则侧重于检索和分析数据，它的一系列操作就是为你的搜索作提前准备的，就像搜索引擎在你浏览网页之前，已经用爬虫分析了很多网页，看里面有哪些关键词，并进行分类记录，这都需要消耗资源。</p>
<p>es就像一个小型的搜索引擎，为你的数据建立索引，然后提供搜索和分析数据的功能。</p>
<p>web开发中，在以下场景可以使用es：</p>
<ul>
<li>你的网站或者APP需要添加搜索功能</li>
<li>存储和分析日志等</li>
<li>使用机器学习自动对数据进行实时分析和建模</li>
</ul>
<h2 id="2-yun-xing-es">2 运行es</h2>
<p>es跟<em>redis</em>类似，本身需要先运行一个server端，然后用client去连接server。</p>
<h3 id="2-1-yun-xing-serverduan">2.1 运行server端</h3>
<p>详见<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html">官方文档</a>，启动server端比较简单，在windows上两种常见的运行方式：</p>
<ul>
<li>下载es压缩包，解压以后直接在本地运行</li>
<li>在docker里面运行</li>
</ul>
<p>server端通常开放<code>9200</code>端口。</p>
<h3 id="2-2-yun-xing-client">2.2 运行client</h3>
<p>client是相对于server的称呼，实际上我们通过API就可以直接跟server端通信了。<br />
比如，在<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html#add-data">官方入门教程</a>中，从step3开始的那些操作，都可以用api测试软件来直接测试，不需要<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html#run-elasticsearch"><em>安装并运行Kibana</em></a>这一步。<br />
举个例子，step3里面的添加数据，在<em>Kibana</em>中运行代码如下：</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">POST logs-my_app-default/_doc
{
  &quot;@timestamp&quot;: &quot;2099-05-06T16:21:15.000Z&quot;,
  &quot;event&quot;: {
    &quot;original&quot;: &quot;192.0.2.42 - - [06/May/2099:16:21:15 +0000] \&quot;GET /images/bg.jpg HTTP/1.0\&quot; 200 24736&quot;
  }
}
</span></code></pre>
<p>那么，可以用api测试软件（如chrome应用商店里的<a href="https://chrome.google.com/webstore/detail/talend-api-tester-free-ed/aejoelaoggembcahagimdiliamlcdmfm?hl=zh-CN">Talend API Tester - Free Edition</a>）发送<code>post</code>请求到<code>http://localhost:9200/logs-my_app-default/_doc?</code>并携带<code>{}</code>的内容。如下图所示：</p>
<details>
<summary>查看图片</summary>
<p><img src="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/apitester.png" alt="image" /></p>
</details>
<p><strong>教程中GET方法携带了json内容，而常规的GET方法不能携带内容，这里只要把GET改成POST即可。</strong></p>
<h2 id="3-zai-javaxiang-mu-zhong-shi-yong-es">3 在java项目中使用es</h2>
<p>主要介绍当下流行的两种方式。</p>
<h3 id="3-1-java-high-level-rest-client">3.1 Java High Level REST Client</h3>
<p>官方提供的方式，通过引入<em>Maven</em>依赖直接使用。</p>
<h4 id="di-yi-bu-yin-ru-yi-lai">第一步：引入依赖</h4>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">&lt;dependency&gt;
    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;
    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;
    &lt;version&gt;7.12.1&lt;/version&gt;
&lt;/dependency&gt;
</span></code></pre>
<p>官方还有一个<code>Java Low Level REST Client</code>，这个更接近原版的es操作，<code>Java High Level REST Client</code>是在其基础上进一步封装。
&gt;关于Jest：jest是<code>Java HTTP Rest client for ElasticSearch</code>，是java端的<code>RESTful</code>风格的client，但现在很少用了。从<a href="https://github.com/elastic/elasticsearch">es源码</a>和<a href="https://github.com/searchbox-io/Jest">jest源码</a>的历史分析，es最早在2010年发布，而jest在2012年发布，但es直到2016发布的5.0版本之前，官方都没有提供<code>RESTful</code>风格的java client，而是一直用的<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/5.6/client.html">TranspostClient</a>。5.0版本的es提供了<code>Java Rest Client</code>，而2017年的6.0进一步提供了<code>Java High Level REST Client</code>，并将原来的<code>Java Rest Client</code>更名为<code>Java Low Level REST Client</code>，至此以后，jest逐渐淡出历史舞台，最后一次<em>release</em>已经是2018年，所以本文不再介绍jest的使用。</p>
<h4 id="di-er-bu-chu-shi-hua-client">第二步：初始化<code>client</code></h4>
<p><code>RestHighLevelClient</code>的初始化要依赖于<code>REST low-level client builder</code>,因为后者在运行时有一些连接池和线程资源，所以在使用后需要手动关闭<code>RestHighLevelClient</code>来间接释放这些资源。</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#ebcb8b;">RestHighLevelClient</span><span style="color:#c0c5ce;"> client = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">RestHighLevelClient</span><span style="color:#c0c5ce;">(
        </span><span style="color:#ebcb8b;">RestClient</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">builder</span><span style="color:#c0c5ce;">(
                </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">HttpHost</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">localhost</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">9200</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">http</span><span style="color:#c0c5ce;">&quot;)
        )
);
client.</span><span style="color:#bf616a;">close</span><span style="color:#c0c5ce;">();
</span></code></pre><h4 id="di-san-bu-chuang-jian-dui-ying-gong-neng-de-request">第三步：创建对应功能的<code>Request</code></h4>
<p>整个<code>RestHighLevelClient</code>的使用方式就是，在上面<a href="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96%60client%60">第二步</a>的初始化后，根据不同的需求去构造对应的<code>xxxRequest</code>，然后用<code>client</code>去执行这个<code>xxxRequest</code>,并返回<code>xxxResponse</code>。<br />
同步执行方式为<code>client.xxx(xxxRequest,options)</code>，异步执行方式只需在xxx后加<code>Aysnc</code>标识，如<code>client.xxxAsync(xxxRequest,options)</code>，但异步执行不能马上获取结果，需要借助回调函数处理。<br />
比如，要构建<code>Index</code>:</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#65737e;">//示例数据
</span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;"> jsonString = &quot;</span><span style="color:#a3be8c;">{</span><span style="color:#c0c5ce;">&quot; +
        &quot;</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">user</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">:</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">kimchy</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">,</span><span style="color:#c0c5ce;">&quot; +
        &quot;</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">postDate</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">:</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">2013-01-30</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">,</span><span style="color:#c0c5ce;">&quot; +
        &quot;</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">message</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">:</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#a3be8c;">trying out Elasticsearch</span><span style="color:#96b5b4;">\&quot;</span><span style="color:#c0c5ce;">&quot; +
        &quot;</span><span style="color:#a3be8c;">}</span><span style="color:#c0c5ce;">&quot;;
</span><span style="color:#65737e;">//构建IndexRequest
</span><span style="color:#ebcb8b;">IndexRequest</span><span style="color:#c0c5ce;"> request = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">IndexRequest</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">posts</span><span style="color:#c0c5ce;">&quot;).</span><span style="color:#bf616a;">id</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">1</span><span style="color:#c0c5ce;">&quot;).</span><span style="color:#bf616a;">source</span><span style="color:#c0c5ce;">(jsonString,</span><span style="color:#ebcb8b;">XContentType</span><span style="color:#c0c5ce;">.</span><span style="color:#d08770;">JSON</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">//执行index
</span><span style="color:#ebcb8b;">IndexResponse</span><span style="color:#c0c5ce;"> response = client.</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">(request, </span><span style="color:#ebcb8b;">RequestOptions</span><span style="color:#c0c5ce;">.</span><span style="color:#d08770;">DEFAULT</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">//异步执行
//IndexResponse response = client.indexAsync(request, RequestOptions.DEFAULT);
// listener = new ActionListener&lt;IndexResponse&gt;() {
//     @Override
//     public void onResponse(IndexResponse indexResponse) {
        //在这里操作IndexResponse
//     }

//     @Override
//     public void onFailure(Exception e) {
        
//     }
// };
</span></code></pre>
<p>或者要执行<code>search</code>：</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#65737e;">//构建SearchRequest
</span><span style="color:#ebcb8b;">SearchRequest</span><span style="color:#c0c5ce;"> searchRequest=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">SearchRequest</span><span style="color:#c0c5ce;">();
</span><span style="color:#ebcb8b;">SearchSourceBuilder</span><span style="color:#c0c5ce;"> searchSourceBuilder=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">SearchSourceBuilder</span><span style="color:#c0c5ce;">();
searchSourceBuilder.</span><span style="color:#bf616a;">query</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">QueryBuilders</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">matchAllQuery</span><span style="color:#c0c5ce;">());
searchRequest.</span><span style="color:#bf616a;">source</span><span style="color:#c0c5ce;">(searchSourceBuilder);
</span><span style="color:#65737e;">//执行search
</span><span style="color:#ebcb8b;">SearchResponse</span><span style="color:#c0c5ce;"> searchResponse=client.</span><span style="color:#bf616a;">search</span><span style="color:#c0c5ce;">(searchRequest,</span><span style="color:#ebcb8b;">RequestOptions</span><span style="color:#c0c5ce;">.</span><span style="color:#d08770;">DEFAULT</span><span style="color:#c0c5ce;">);
</span></code></pre>
<p>更多API使用参见<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html">官方文档</a></p>
<h3 id="3-2-spring-data-elasticsearch">3.2 spring-data-elasticsearch</h3>
<p><code>spring-data-elasticsearch</code>是<a href="https://spring.io/projects/spring-data">spring-data</a>这个大项目中的一员，它的主要目的是方便在<em>spring</em>项目中使用<em>elasticsearch</em>,是对<a href="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/#3.1-Java-High-Level-REST-Client">上面</a>介绍的<code>Java High Level REST Client</code>的封装。因为封装也需要时间，所以<code>spring-data-elasticsearch</code>使用的不一定是最新版的elasticsearch，具体的版本依赖参见<a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.2.0/reference/html/#preface.requirements">官方说明</a>。</p>
<p>下面的例子假设是一个<code>springboot</code>项目：</p>
<h4 id="di-yi-bu-sheng-cheng-springbootxiang-mu">第一步：生成springboot项目</h4>
<p>先用<a href="https://www.jetbrains.com/idea/">Idea</a>快速生成一个springboot项目，选上web功能</p>
<h4 id="di-er-bu-yin-ru-yi-lai">第二步：引入依赖</h4>
<p>在pom.xml文件中添加：</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#c0c5ce;">&lt;dependency&gt;
        &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
        &lt;artifactId&gt;spring-data-elasticsearch&lt;/artifactId&gt;
        &lt;version&gt;</span><span style="color:#d08770;">4.2.0</span><span style="color:#c0c5ce;">&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- 如果第一步没有勾选web功能，则加上下面这个依赖 --&gt;
&lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
</span></code></pre>
<p>这里不引入<em>web</em>依赖的话，后面的例子运行会报错，因为要用到<code>org.springframework.http</code>这个<em>package</em>里的<code>HttpHeaders</code>等类，这个<em>package</em>属于<em>web</em>依赖。</p>
<h4 id="di-san-bu-xie-pei-zhi-lei">第三步：写配置类</h4>
<p>这一步主要是为了注册<code>RestHighLevelClient</code>这个Bean</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#b48ead;">package </span><span style="color:#c0c5ce;">com.example.esdemo;

</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.elasticsearch.client.</span><span style="color:#ebcb8b;">RestHighLevelClient</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.springframework.context.annotation.</span><span style="color:#ebcb8b;">Bean</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.springframework.context.annotation.</span><span style="color:#ebcb8b;">Configuration</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.springframework.data.elasticsearch.client.</span><span style="color:#ebcb8b;">ClientConfiguration</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.springframework.data.elasticsearch.client.</span><span style="color:#ebcb8b;">RestClients</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.springframework.data.elasticsearch.config.</span><span style="color:#ebcb8b;">AbstractElasticsearchConfiguration</span><span style="color:#c0c5ce;">;

@</span><span style="color:#bf616a;">Configuration
</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">EsConfig </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">AbstractElasticsearchConfiguration </span><span style="color:#eff1f5;">{
    @</span><span style="color:#bf616a;">Override
    </span><span style="color:#eff1f5;">@</span><span style="color:#bf616a;">Bean
    </span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">RestHighLevelClient </span><span style="color:#8fa1b3;">elasticsearchClient</span><span style="color:#eff1f5;">() {
        </span><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">ClientConfiguration</span><span style="color:#eff1f5;"> clientConfiguration</span><span style="color:#c0c5ce;">=</span><span style="color:#ebcb8b;">ClientConfiguration</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">builder</span><span style="color:#eff1f5;">()
                .</span><span style="color:#bf616a;">connectedTo</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">localhost:9200</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">)
                .</span><span style="color:#bf616a;">build</span><span style="color:#eff1f5;">();

        </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">RestClients</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">create</span><span style="color:#eff1f5;">(clientConfiguration).</span><span style="color:#bf616a;">rest</span><span style="color:#eff1f5;">();
    }
}

</span></code></pre><h4 id="di-si-bu-ce-shi">第四步：测试</h4>
<p>在<code>test</code>文件夹下，写一个<code>Index</code>测试一下</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#b48ead;">package </span><span style="color:#c0c5ce;">com.example.esdemo;

</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.elasticsearch.action.index.</span><span style="color:#ebcb8b;">IndexRequest</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.elasticsearch.action.index.</span><span style="color:#ebcb8b;">IndexResponse</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.elasticsearch.action.support.</span><span style="color:#ebcb8b;">WriteRequest</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.elasticsearch.client.</span><span style="color:#ebcb8b;">RequestOptions</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.elasticsearch.client.</span><span style="color:#ebcb8b;">RestHighLevelClient</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.junit.jupiter.api.</span><span style="color:#ebcb8b;">Test</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.springframework.beans.factory.annotation.</span><span style="color:#ebcb8b;">Autowired</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.springframework.boot.test.context.</span><span style="color:#ebcb8b;">SpringBootTest</span><span style="color:#c0c5ce;">;

</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">java.io.</span><span style="color:#ebcb8b;">IOException</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">java.util.</span><span style="color:#ebcb8b;">Collections</span><span style="color:#c0c5ce;">;

@</span><span style="color:#bf616a;">SpringBootTest
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">EsdemoApplicationTests </span><span style="color:#eff1f5;">{
    @</span><span style="color:#bf616a;">Autowired
    </span><span style="color:#ebcb8b;">RestHighLevelClient </span><span style="color:#eff1f5;">highLevelClient;

    @</span><span style="color:#bf616a;">Test
    </span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">contextLoads</span><span style="color:#eff1f5;">() </span><span style="color:#b48ead;">throws </span><span style="color:#ebcb8b;">IOException </span><span style="color:#eff1f5;">{


        </span><span style="color:#ebcb8b;">IndexRequest</span><span style="color:#eff1f5;"> request</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">IndexRequest</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">spring-data</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">)
                .</span><span style="color:#bf616a;">id</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">1</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">)
                .</span><span style="color:#bf616a;">source</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Collections</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">singletonMap</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">feature</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">,</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">high-level-rest-client</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">))
                .</span><span style="color:#bf616a;">setRefreshPolicy</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">WriteRequest</span><span style="color:#eff1f5;">.</span><span style="color:#ebcb8b;">RefreshPolicy</span><span style="color:#eff1f5;">.</span><span style="color:#d08770;">IMMEDIATE</span><span style="color:#eff1f5;">);

        </span><span style="color:#ebcb8b;">IndexResponse</span><span style="color:#eff1f5;"> response</span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;">highLevelClient.</span><span style="color:#bf616a;">index</span><span style="color:#eff1f5;">(request, </span><span style="color:#ebcb8b;">RequestOptions</span><span style="color:#eff1f5;">.</span><span style="color:#d08770;">DEFAULT</span><span style="color:#eff1f5;">);
        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(response);
    }
}

</span></code></pre>
<p>输出：（执行次数不同结果会有一点差异）</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">IndexResponse[index=spring-data,type=_doc,id=1,version=5,result=updated,seqNo=4,primaryTerm=1,shards={&quot;total&quot;:2,&quot;successful&quot;:1,&quot;failed&quot;:0}]
</span></code></pre>
<p>最终我们的项目文件结构如下图：</p>
<details>
<summary>查看图片</summary>
<p><img src="https://www.fewth.com/elasticsearchfen-bu-shi-sou-suo-yin-qing/demo-project-structure.png" alt="image" /></p>
</details>
<p><code>spring-data-elasticsearch</code>的内容比较多，这里只是一个很简单的例子，详见<a href="https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/#reference">官方文档</a></p>

    </div>

    
    

    <div class="post-footer">
        
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;windowsyong-dockerbu-shu-redisji-qun&#x2F;">‹ Windows用Docker部署Redis集群</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;javazhu-jie&#x2F;">Java注解 ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.fewth.com&#x2F;even.js" ></script>
      
    </body>

</html>
