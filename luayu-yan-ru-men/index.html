<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title> - Lua语言入门</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">

          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy" crossorigin="anonymous"></script>
              
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
                  onload="renderMathInElement(document.body);"></script>
              
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;site.css">
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Even</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.fewth.com">Even</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://www.fewth.com/luayu-yan-ru-men/#1-bian-liang" class="toc-link">1 变量</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/luayu-yan-ru-men/#bian-liang-ming-cheng" class="toc-link">变量名称</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/luayu-yan-ru-men/#da-xiao-xie" class="toc-link">大小写</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/luayu-yan-ru-men/#bian-liang-zuo-yong-yu" class="toc-link">变量作用域</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/luayu-yan-ru-men/#bian-liang-lei-xing" class="toc-link">变量类型</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/luayu-yan-ru-men/#2-zhu-shi" class="toc-link">2 注释</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/luayu-yan-ru-men/#3-yu-fa" class="toc-link">3 语法</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/luayu-yan-ru-men/#4-i-ocao-zuo" class="toc-link">4 I&#x2F;O操作</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/luayu-yan-ru-men/#5-metatablehe-metamethod" class="toc-link">5 metatable和metamethod</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/luayu-yan-ru-men/#5-1-metatable" class="toc-link">5.1 metatable</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/luayu-yan-ru-men/#5-2-metamethod" class="toc-link">5.2 metamethod</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/luayu-yan-ru-men/#6-mian-xiang-dui-xiang" class="toc-link">6 面向对象</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/luayu-yan-ru-men/#6-1-chuang-jian-yi-ge-dui-xiang" class="toc-link">6.1 创建一个对象</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/luayu-yan-ru-men/#6-2-ji-cheng" class="toc-link">6.2 继承</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;luayu-yan-ru-men&#x2F;">Lua语言入门</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2021-08-01</span>
            
        </div>
    </header>

    <div class="post-content">
      <h2 id="1-bian-liang">1 变量</h2>
<h3 id="bian-liang-ming-cheng">变量名称</h3>
<p>变量由字母、数字、下划线组成，但不能由数字开头，且不建议<code>_A**</code>这种下划线后接大写字母的方式，通常作为Lua内部特殊用途。下面的几个词是<code>Lua</code>保留的关键字：</p>
<!--more-->
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">and or false true not repeat
if break do else elseif then end  for  goto while until in
local nil return function
</span></code></pre><h3 id="da-xiao-xie">大小写</h3>
<p><code>Lua</code>是大小写敏感的。</p>
<h3 id="bian-liang-zuo-yong-yu">变量作用域</h3>
<p><code>Lua</code>默认都是全局变量，包括在函数内声明的变量。<br />
本地变量以<code>local</code>开头，应该尽量使用<code>local</code>变量避免变量冲突。</p>
<p>变量不需要声明，直接使用即可，默认值是<code>nil</code>，给任何变量赋值<code>nil</code>等价于删除这个变量。</p>
<h3 id="bian-liang-lei-xing">变量类型</h3>
<p><code>Lua</code>中有八种变量类型，分别是：</p>
<p><code>nil boolean number string userdata function thread table</code></p>
<p>可以用<code>type()</code>函数获取变量类型。</p>
<p><code>nil</code>:区别于任意变量类型的特殊类型，表示空值</p>
<p><code>boolean</code>:<code>Lua</code>中只有<code>false</code>和<code>nil</code>表示<code>false</code>，其余值都表示<code>true</code>,<code>and</code>和<code>or</code>是短路判断，<code>a and b</code>在<code>a</code>为真时返回<code>b</code>,<code>a</code>为假时返回a,<code>a or b</code>反之。<code>Lua</code>中不相等的判断符号是<code>~=</code>,其余的跟大部分语言没差别。</p>
<h4 id="number">number</h4>
<p>所有的整数和浮点数都可以用<code>number</code>表示，<code>3==3.0</code>也是<code>true</code>,<code>math.type</code>可以区别浮点数类型。</p>
<p><code>0x</code>开头表示16进制数，可以用<code>p*</code>的形式表示位移，正数表示左移，如<code>0x1p1</code>=4.0，<code>0x1p4</code>=16.0</p>
<p>支持常规四则运算，<code>//</code>（两个除号）可以表示向下（负无穷）取整，如<code>3//2</code>==1，<code>-3//2</code>=-2，<code>3//-2</code>=-2，跟取余计算有如下关系：</p>
<p><code>a % b == a - ((a // b) * b)</code></p>
<p>当<code>a,b</code>分别出现正负号时，有4种情况:</p>
<ul>
<li>a,b都为正，余数为正，<code>3%2=1</code></li>
<li>a,b都为负，<code>-3%-2=-1</code></li>
<li>a正b负，<code>3%-2=-1</code></li>
<li>a负b正，<code>-3%2=1</code></li>
</ul>
<p>总结一下就是，余数的符号跟除数一致。</p>
<h4 id="string">string</h4>
<p><code>string</code>实际上是<code>byte</code>的序列。</p>
<p><code>#s</code>可以获取字符串变量s内的长度，包含其中的空格等，返回的是<code>byte</code>的数量。</p>
<p>Lua的string跟java里一样,也是不可变的，但是可以通过函数用原来的字符串替换内容后生成新的字符串。</p>
<p><code>..</code>（两个点号）可以连接两个字符串，<code>&quot;hello&quot;..&quot; wolrd&quot;-&gt;&quot;hello world</code></p>
<p><code>tonumber</code>和<code>tostring</code>函数可以让字符串和数字相互转化。</p>
<h4 id="userdata">userdata</h4>
<p>可以保存任何<code>C</code>语言的数据</p>
<h4 id="function">function:</h4>
<p><code>function</code>可以传入任意数量的参数，多余的会被自动丢弃，没有传入的参数默认为<code>nil</code>。</p>
<p>函数可以有多个返回值，当函数作为中间过程调用时，只取第一个返回值，多返回值<strong>只在以下</strong>4个情况出现：</p>
<ul>
<li>多个变量接收返回值，此时多余的变量赋值为<code>nil</code>，多余的返回值被丢弃</li>
<li>作为另一个函数的参数传递，并且是最后一个传入的参数，如<code>g(a,b,f())</code></li>
<li>作为<code>table</code>构造时的参数,并且是最后一个传入的参数，如<code>tab={a,b,f()}</code></li>
<li>被<code>return</code>语句调用
上面的情况都必须是直接符合条件，不能有括号，比如<code>return (fun())</code>这里的<code>fun()</code>的返回值是先被<code>()</code>处理，而不是直接被<code>return</code>，所以只能返回第一个值</li>
</ul>
<p>函数可以接收变长参数，用<code>...</code>（3个点号）表示，可以直接使用，如<code>a,b=...</code>获取前两个参数。在函数体内用<code>{...}</code>的方式可以获取到所有参数的列表，然后用<code>ipairs{...}</code>的方式来遍历等，当然，如果参数包含<code>nil</code>这种方式就有缺陷，此时需要用<code>args=table.pack(...)</code>的方式获取参数，再用<code>args.n</code>获取参数数量，遍历排除<code>nil</code>。</p>
<h4 id="thread">thread:</h4>
<h4 id="table">table:</h4>
<p>一种强大的存储数据对象，用键值对的方式保存数据，除了<code>nil</code>以外的任何值都可以作为键。很像一个自动扩容的数组。</p>
<p>初始化方式为：<code>a={}</code>，初始化时可以带元素，没有指定<code>key</code>的数据从1开始按顺序排<code>key</code>,也可以用<code>key=value</code>这种键值对的方式传入多个初始化的数据。<code>key</code>可以用<code>[]</code>包裹，来使用表达式作为<code>key</code>。<br />
这里<code>a</code>只是一个指向这个<code>table</code>的变量，<code>table</code>本身是匿名的，借助<code>a</code>来操作这个<code>table</code>，如果所有指向这个<code>table</code>的变量都被赋值为<code>nil</code>，那么这个<code>table</code>的资源就会被系统回收。</p>
<p>浮点数和整数作为键时，如果值相等，则指向同一个index，比如<code>2.0</code>和<code>2</code>是相同的，这里键的判断跟<code>==</code>是一样的。</p>
<p><code>#</code>符号也可以获取<code>table</code>的长度，但是需要没有<code>nil</code>值在列表中间，这种连续存储的叫<strong>序列</strong>。如果想要获取有<code>nil</code>的<code>table</code>的长度，需要额外存放一个变量统计长度，并把它放在<code>table</code>中。</p>
<p>遍历<code>table</code>，可以用下面几种方式：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#b48ead;">for </span><span style="color:#bf616a;">k</span><span style="color:#c0c5ce;">,</span><span style="color:#bf616a;">v </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">pairs</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">) </span><span style="color:#b48ead;">do </span><span style="color:#65737e;">-- 对任意table都有效，但不保证元素输出的顺序
    --dosth
</span><span style="color:#b48ead;">end

for </span><span style="color:#bf616a;">k</span><span style="color:#c0c5ce;">,</span><span style="color:#bf616a;">v </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">ipairs</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">) </span><span style="color:#b48ead;">do </span><span style="color:#65737e;">--遍历列表
    --dosth
</span><span style="color:#b48ead;">end

for </span><span style="color:#bf616a;">k</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">,#</span><span style="color:#bf616a;">a </span><span style="color:#b48ead;">do  </span><span style="color:#65737e;">--对于没有nil值的序列
    --dosth
</span><span style="color:#b48ead;">end
</span></code></pre>
<p>关于嵌套<code>table</code>的导航，可以用<code>or {}</code>的方式获取空值，避免报错和对前面层次的反复获取。</p>
<p><code>table</code>库有<code>insert,remove</code>等方法，具体用时可查。</p>
<h2 id="2-zhu-shi">2 注释</h2>
<p>单行注释用<code>--</code>开头。<br />
多行注释用<code>--[[</code>开头，直到<code>]]</code>结束。比如：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#65737e;">--[[
    print(&quot;hello world&quot;);
]]
</span></code></pre>
<p>多行注释的时候有个小技巧，把结尾的<code>]]</code>也用<code>--</code>开头，即：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#65737e;">--[[
    print(&quot;hello world&quot;);
--]]
</span></code></pre>
<p>当我们需要取消注释的时候，在注释开头添加一个<code>-</code>即可，即<code>---[[</code>，因为这个操作会让<code>-[[</code>这几个字符变成了单行注释的内容，而结束的<code>--]]</code>也因为块注释的失效而变成了单行注释，此时<code>print</code>语句就生效了。当然，这种技巧应该只在调试的时候使用，重要的代码建议还是保持整结，这种方式看上去有点混乱。</p>
<h2 id="3-yu-fa">3 语法</h2>
<p>分号和换行都不是必要的，内容用空格分隔即可，但是最好还是用行分隔或者分号分隔，显得清晰。</p>
<p>函数体和<code>if</code>语句等都有<code>end</code>标识符结尾。</p>
<h2 id="4-i-ocao-zuo">4 I/O操作</h2>
<p>简单版的基于<code>input</code>和<code>output</code>两个流来操作，基本只跟以下几个命令有关：</p>
<ul>
<li><code>io.input</code>:指定输入流来源，默认是标准输入</li>
<li><code>io.output()</code>:指定输出流目标，默认是标准输出（stardard output)</li>
<li><code>io.write</code>：写内容到输出流，需要<code>io.flush()</code>或者关闭流才能输出到文件</li>
<li><code>io.read()</code>:从输入流读取内容，根据传入的参数表现不同的读取方式：
<ul>
<li><code>&quot;a&quot;</code>：读取文件所有内容</li>
<li><code>&quot;l&quot;</code>:读一行，不包含换行符</li>
<li><code>&quot;L&quot;</code>:读一行，包含换行符</li>
<li><code>&quot;n&quot;</code>:读一个数字</li>
<li><code>n</code>：读取n个字符，这里的n表示数量</li>
</ul>
</li>
</ul>
<h2 id="5-metatablehe-metamethod">5 metatable和metamethod</h2>
<p><code>Lua</code>的面对向象主要是借助<code>table</code>实现的，在学习面向对象之前，先了解一下<code>metatable</code>相关的内容。</p>
<h3 id="5-1-metatable">5.1 metatable</h3>
<p><code>metatable</code>本身是一个普通的<code>table</code>，而<code>table</code>可以用一个<code>setmetatable</code>方法来设置自身的<code>metatable</code>值，<code>getmetatable</code>方法来获取相应的值。</p>
<p>只设置<code>metatable</code>属性是不够的，还需要结合对应的<code>metamethod</code>（元方法）。</p>
<h3 id="5-2-metamethod">5.2 metamethod</h3>
<p><code>Lua</code>内核原生支持以下几种方法(都是2个下划线开头）：</p>
<ul>
<li>算术操作符重载
<ul>
<li>
<p><code>__add</code>:给这个字段指定方法后，<code>+</code>操作就会使用这个方法来实现，默认情况下<code>table</code>是不支持<code>+</code>操作的。看下面的例子：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#bf616a;">Testtab</span><span style="color:#c0c5ce;">={};
</span><span style="color:#b48ead;">local </span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">={}; </span><span style="color:#65737e;">-- 初始化metatable
</span><span style="color:#bf616a;">Testtab</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">new</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">function</span><span style="color:#c0c5ce;">(t1)
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">local </span><span style="color:#bf616a;">tab</span><span style="color:#c0c5ce;">={};
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">setmetatable</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">tab</span><span style="color:#c0c5ce;">,</span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">); </span><span style="color:#65737e;">-- 设置metatable
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">value </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">ipairs</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">t1</span><span style="color:#c0c5ce;">) </span><span style="color:#b48ead;">do
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">tab</span><span style="color:#c0c5ce;">[#</span><span style="color:#bf616a;">tab</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">]=</span><span style="color:#bf616a;">value</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">end
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">tab</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">end

</span><span style="color:#b48ead;">local </span><span style="color:#bf616a;">tab1</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Testtab</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">({</span><span style="color:#d08770;">10</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">});
</span><span style="color:#b48ead;">local </span><span style="color:#bf616a;">tab2</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Testtab</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">({</span><span style="color:#d08770;">100</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">200</span><span style="color:#c0c5ce;">})

</span><span style="color:#65737e;">--以下两种实现方式的效果是一样的，输出合并后的结果

</span><span style="color:#65737e;">-- Testtab.merge=function (t1,t2)
</span><span style="color:#65737e;">--     local res={}
</span><span style="color:#65737e;">--     for index, value in ipairs(t1) do
</span><span style="color:#65737e;">--         res[#res+1] = value
</span><span style="color:#65737e;">--     end
</span><span style="color:#65737e;">--     for index, value in ipairs(t2) do
</span><span style="color:#65737e;">--         res[#res+1] = value
</span><span style="color:#65737e;">--     end
</span><span style="color:#65737e;">--     return res
</span><span style="color:#65737e;">-- end
</span><span style="color:#65737e;">-- mt.__add=Testtab.merge;
</span><span style="color:#65737e;">-- for index, value in ipairs(Testtab.merge(tab1,tab2)) do
</span><span style="color:#65737e;">--     print(value..&quot; &quot;)
</span><span style="color:#65737e;">-- end

</span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">__add</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">function </span><span style="color:#c0c5ce;">(t1,t2)
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">local </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">={}
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">value </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">ipairs</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">t1</span><span style="color:#c0c5ce;">) </span><span style="color:#b48ead;">do
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">[#</span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">] = </span><span style="color:#bf616a;">value
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">end
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">value </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">ipairs</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">t2</span><span style="color:#c0c5ce;">) </span><span style="color:#b48ead;">do
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">[#</span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">] = </span><span style="color:#bf616a;">value
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">end
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">res
</span><span style="color:#b48ead;">end

</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">value </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">ipairs</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">tab1</span><span style="color:#c0c5ce;">+</span><span style="color:#bf616a;">tab2</span><span style="color:#c0c5ce;">) </span><span style="color:#b48ead;">do
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">value</span><span style="color:#c0c5ce;">..&quot; &quot;)
</span><span style="color:#b48ead;">end
</span></code></pre></li>
<li>
<p><code>__sub</code>：<code>-</code>减号操作，二元操作</p>
</li>
<li>
<p><code>__mul</code>: <code>*</code>乘号操作</p>
</li>
<li>
<p><code>__div</code>：<code>/</code>除号操作</p>
</li>
<li>
<p><code>__idiv</code>：<code>//</code>向下取整除号操作</p>
</li>
<li>
<p><code>__mod</code>：<code>%</code>取余操作</p>
</li>
<li>
<p><code>__unm</code>：<code>-</code>负号，一元操作符</p>
</li>
<li>
<p><code>__pow</code>：<code>^</code>指数操作</p>
</li>
</ul>
</li>
<li>位操作符重载
<ul>
<li><code>__band</code>：<code>&amp;</code>按位与</li>
<li><code>__bor</code>：<code>|</code>按位或</li>
<li><code>__bxor</code>:<code>~</code>按位异或,<strong>二元操作</strong></li>
<li><code>__not</code>：<code>~</code>，按位取反，<strong>一元操作</strong></li>
<li><code>__shl</code>：<code>&lt;&lt;</code>位左移</li>
<li><code>__shr</code>：<code>&gt;&gt;</code>位右移</li>
</ul>
</li>
<li><code>__concat</code>：连接</li>
<li><code>__len</code>:用<code>#</code>符号获取<code>table</code>长度时调用的方法</li>
<li><code>__pairs</code>：<code>for</code>循环时<code>pairs(k,v)</code>方法的重载</li>
<li>关系比较操作符重载<br />
下面这三个是关系比较操作符，这3个操作就可以解决所有情况，所以只需要实现这3个，剩下的情况可以通过组合这3个来实现。
<ul>
<li><code>__lt</code>：<code>&lt;</code>,less than</li>
<li><code>__le</code>：<code>&lt;=</code>,less or equal than</li>
<li><code>__eq</code>:<code>==</code>,equal</li>
</ul>
</li>
<li><code>table</code>元素读写
<ul>
<li>
<p><code>__index</code>：这个是<code>Lua</code>实现“继承”或者说“原型”的重要属性，当我们在<code>table</code>中读取一个不存在的元素，它就会尝试去<code>__index</code>中寻找，<code>__index</code>的值可以是一个<code>function</code>，也可以是另一个<code>table</code>，用<code>function</code>可以实现的功能更多更灵活，比如添加多个<code>table</code>实现“多继承”。<br />
如果我们只想查找<code>table</code>自己的数据，而不包含从<code>__index</code>“继承”的，那么用<code>rawget(t,i)</code>方法。</p>
</li>
<li>
<p><code>__newindex</code>：跟<code>__index</code>对应，这个操作是“写”相关的，当我们给<code>table</code>设置一个值，如果<code>key</code>不存在，那么会调用<code>__newindex</code>去完成这个操作。跟<code>__index</code>一样，值可以是<code>fuction</code>或者另一个<code>table</code>，<code>rawset</code>方法只写到原始<code>table</code>。一个简单的例子：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#bf616a;">SubA</span><span style="color:#c0c5ce;">={}
</span><span style="color:#bf616a;">ParentA</span><span style="color:#c0c5ce;">={}
</span><span style="color:#b48ead;">local </span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">={}
</span><span style="color:#96b5b4;">setmetatable</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">SubA</span><span style="color:#c0c5ce;">,</span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">)
</span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">.__index=</span><span style="color:#bf616a;">ParentA
</span><span style="color:#65737e;">-- 下面的两种方式是一样的，注意fuction中的第一个参数mytable，它只是一个变量名，
</span><span style="color:#65737e;">--可以是table,tab,甚至 _ 等任意值，用来赋值的function格式就是这样的，
</span><span style="color:#65737e;">--__index中的function也类似
</span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">.__newindex=</span><span style="color:#bf616a;">ParentA

</span><span style="color:#65737e;">-- mt.__newindex=
</span><span style="color:#65737e;">-- function (mytable,k,v)
</span><span style="color:#65737e;">--     ParentA[k]=v
</span><span style="color:#65737e;">-- end
</span><span style="color:#bf616a;">SubA</span><span style="color:#c0c5ce;">[&quot;</span><span style="color:#a3be8c;">foo</span><span style="color:#c0c5ce;">&quot;]=&quot;</span><span style="color:#a3be8c;">bar</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">SubA</span><span style="color:#c0c5ce;">[&quot;</span><span style="color:#a3be8c;">foo</span><span style="color:#c0c5ce;">&quot;]); </span><span style="color:#65737e;">--&quot;bar&quot;,从ParentA里继承
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">rawget</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">SubA</span><span style="color:#c0c5ce;">,&quot;</span><span style="color:#a3be8c;">foo</span><span style="color:#c0c5ce;">&quot;)) </span><span style="color:#65737e;">--nil，因为值设置到了ParentA里
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ParentA</span><span style="color:#c0c5ce;">[&quot;</span><span style="color:#a3be8c;">foo</span><span style="color:#c0c5ce;">&quot;]) </span><span style="color:#65737e;">--&quot;bar&quot;
</span></code></pre></li>
</ul>
</li>
</ul>
<p>总的来说，<code>metatable</code>里包含了各种约定<code>table</code>行为的数据。</p>
<h2 id="6-mian-xiang-dui-xiang">6 面向对象</h2>
<p>在<a href="https://www.fewth.com/luayu-yan-ru-men/#5-metatable%E5%92%8Cmetamethod">metatable</a>的基础上，看一下<code>Lua</code>如何实现面向对象的。</p>
<p>首先，<code>Lua</code>里面没有<code>class</code>的概念，但是<code>__index</code>可以实现“继承”的功能，我们可以用这个属性去构造一个类似原型链的模型。</p>
<h3 id="6-1-chuang-jian-yi-ge-dui-xiang">6.1 创建一个对象</h3>
<p>保存<code>table</code>的变量实际上是保存对这个<code>table</code>的引用，把这种变量赋值给另一个变量并不会产生新的<code>table</code>，而是对同一个<code>table</code>多了一个引用而已，所以下面的这种方式创建对象是<strong>不可行</strong>的：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">={</span><span style="color:#a3be8c;">money</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">}
</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Person
p1</span><span style="color:#c0c5ce;">.money=</span><span style="color:#d08770;">20
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.money) </span><span style="color:#65737e;">--输出20,因为两者指向的是同一个table
</span></code></pre>
<p>我们可以写一个<code>new</code>方法来返回一个新的对象：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">={</span><span style="color:#a3be8c;">money</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">}
</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">new</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">function</span><span style="color:#c0c5ce;">(){
    </span><span style="color:#a3be8c;">obj</span><span style="color:#c0c5ce;">={} </span><span style="color:#65737e;">--一个新的table,用来返回新的对象
    </span><span style="color:#a3be8c;">mt</span><span style="color:#c0c5ce;">={} </span><span style="color:#65737e;">--metatable
    </span><span style="color:#96b5b4;">setmetatable</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">obj</span><span style="color:#c0c5ce;">,</span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;">--设置metatable
    </span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">.__index=</span><span style="color:#bf616a;">Person </span><span style="color:#65737e;">--设置obj的“原型”为Person
</span><span style="color:#c0c5ce;">    r</span><span style="color:#bf616a;">eturn obj
</span><span style="color:#c0c5ce;">}

</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.new
</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">.money=</span><span style="color:#d08770;">20
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.money) </span><span style="color:#65737e;">--0，p1是一个新创建的table，跟Person已经不是同一个
</span></code></pre>
<p>加入一个<code>new</code>方法解决了属性的问题，但“对象的方法”仍然存在问题，给上面的例子加一个方法：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">={</span><span style="color:#a3be8c;">money</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">}
</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">new</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">function </span><span style="color:#c0c5ce;">()
    </span><span style="color:#bf616a;">obj</span><span style="color:#c0c5ce;">={}
    </span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">={}
    </span><span style="color:#96b5b4;">setmetatable</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">obj</span><span style="color:#c0c5ce;">,</span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">)
    </span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">.__index=</span><span style="color:#bf616a;">Person
    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">obj
</span><span style="color:#b48ead;">end

</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">function </span><span style="color:#c0c5ce;">(n)
    </span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.money=</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.money+</span><span style="color:#bf616a;">n
</span><span style="color:#b48ead;">end
</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">()
</span><span style="color:#bf616a;">p2</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">()
</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">10</span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;">--把money添加到了Person.moeny中
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">p1&#39;s money:</span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">.money)
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">p2&#39;s money:</span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">p2</span><span style="color:#c0c5ce;">.money)
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Person&#39;s money:</span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.money)
</span></code></pre>
<p>例子中，因为我们的<code>add</code>方法是对<code>Person.money</code>硬编码的，导致所有由<code>Person.new</code>生成的对象，在使用<code>add</code>方法时，都把<code>money</code>的值加到了<code>Person.money</code>上，这样显然是不行的，可以通过在方法中传入一个当前对象的引用来解决：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">={</span><span style="color:#a3be8c;">money</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">}
</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">new</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">function </span><span style="color:#c0c5ce;">()
    </span><span style="color:#bf616a;">obj</span><span style="color:#c0c5ce;">={}
    </span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">={}
    </span><span style="color:#96b5b4;">setmetatable</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">obj</span><span style="color:#c0c5ce;">,</span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">)
    </span><span style="color:#bf616a;">mt</span><span style="color:#c0c5ce;">.__index=</span><span style="color:#bf616a;">Person
    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">obj
</span><span style="color:#b48ead;">end

</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">function </span><span style="color:#c0c5ce;">(self,n)
    </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.money=</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.money+</span><span style="color:#bf616a;">n
</span><span style="color:#b48ead;">end
</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">()
</span><span style="color:#bf616a;">p2</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">()
</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">10</span><span style="color:#c0c5ce;">) 
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">p1&#39;s money:</span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">.money)
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">p2&#39;s money:</span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">p2</span><span style="color:#c0c5ce;">.money)
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Person&#39;s money:</span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.money)
</span></code></pre>
<p>修改后的例子中的<code>add</code>方法，传入了一个<code>self</code>参数，每次调用方法时，都会把<code>money</code>加到<code>self</code>的<code>money</code>属性上。这里的<code>self</code>参数，当显式的传入时，可以用任何名称，不过还可以通过<code>:</code>（冒号）符号隐式的调用，但是方法的定义只能是<code>function obj:fun_name</code>的方式（前面的例子中<code>Person.add=funtion()</code>和<code>function Person.add()</code>都是可以的,<code>add</code>方法可以改成下面这样，效果跟上面是一样的：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#b48ead;">function </span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">:</span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(n) </span><span style="color:#65737e;">-- 隐式的传入参数self
    </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.money=</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.money+</span><span style="color:#bf616a;">n
</span><span style="color:#b48ead;">end

</span><span style="color:#65737e;">-- p1.add(p1,10)===p1:add(10)
</span></code></pre>
<p>还有两个可以优化的点：</p>
<ul>
<li><code>new</code>方法可以传入参数，实现“有参”构造函数的功能</li>
<li><code>metatable</code>实际上也是一个普通的<code>table</code>，我们完全可以用对象本身的<code>table</code>来完成这个功能，也就是引入<code>self</code>参数，所以<code>new</code>方法也用<code>:</code>的方式定义和调用</li>
</ul>
<p>优化后的类如下：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">={</span><span style="color:#a3be8c;">money</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">}
</span><span style="color:#b48ead;">function </span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">:</span><span style="color:#8fa1b3;">new</span><span style="color:#c0c5ce;">(obj)
    </span><span style="color:#bf616a;">obj</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">obj </span><span style="color:#c0c5ce;">or {} </span><span style="color:#65737e;">--如果没有传入参数，则obj=nil,根据or的短路判断，初始化为{}，
    </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.__index=</span><span style="color:#bf616a;">self </span><span style="color:#65737e;">--把self当作metatable,设置它的__index属性为self自身指向的table，节省一个table变量的命名
    </span><span style="color:#96b5b4;">setmetatable</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">obj</span><span style="color:#c0c5ce;">,</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;">--给obj设置metatable，结合__index属性，obj相当于“继承”了self(也就是Person)的内容
    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">obj
</span><span style="color:#b48ead;">end


function </span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">:</span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(n)
    </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.money=</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.money+</span><span style="color:#bf616a;">n
</span><span style="color:#b48ead;">end

</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">:</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">()
</span><span style="color:#bf616a;">p2</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">:</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">()
</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">:</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">10</span><span style="color:#c0c5ce;">) 
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">p1&#39;s money:</span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">p1</span><span style="color:#c0c5ce;">.money)
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">p2&#39;s money:</span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">p2</span><span style="color:#c0c5ce;">.money)
</span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Person&#39;s money:</span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">.money)
</span></code></pre><h3 id="6-2-ji-cheng">6.2 继承</h3>
<p>继承也是用<code>__index</code>这个属性实现的，其实确切的说，这个模型更接近原型链。看一下例子：</p>
<pre style="background-color:#2b303b;">
<code class="language-lua" data-lang="lua"><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">={</span><span style="color:#a3be8c;">money</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">100</span><span style="color:#c0c5ce;">}
</span><span style="color:#b48ead;">function </span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">:</span><span style="color:#8fa1b3;">new</span><span style="color:#c0c5ce;">(obj)
    </span><span style="color:#bf616a;">obj</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">obj </span><span style="color:#c0c5ce;">or {}
    </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.__index=</span><span style="color:#bf616a;">self
    </span><span style="color:#96b5b4;">setmetatable</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">obj</span><span style="color:#c0c5ce;">,</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">)
    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">obj
</span><span style="color:#b48ead;">end


function </span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">:</span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(n)
    </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.money=</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.money+</span><span style="color:#bf616a;">n
</span><span style="color:#b48ead;">end

</span><span style="color:#bf616a;">Employee</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Person</span><span style="color:#c0c5ce;">:</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">()
</span><span style="color:#b48ead;">function </span><span style="color:#bf616a;">Employee</span><span style="color:#c0c5ce;">:</span><span style="color:#8fa1b3;">say</span><span style="color:#c0c5ce;">()
    </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">I have </span><span style="color:#c0c5ce;">&quot;..</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.money..&quot;</span><span style="color:#a3be8c;"> dollors</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#b48ead;">end
</span><span style="color:#bf616a;">e</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">Employee</span><span style="color:#c0c5ce;">:</span><span style="color:#bf616a;">new</span><span style="color:#c0c5ce;">()
</span><span style="color:#bf616a;">e</span><span style="color:#c0c5ce;">:</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">100</span><span style="color:#c0c5ce;">)
</span><span style="color:#bf616a;">e</span><span style="color:#c0c5ce;">:</span><span style="color:#bf616a;">say</span><span style="color:#c0c5ce;">() </span><span style="color:#65737e;">-- I have 200 dollors
</span></code></pre>
<p>例子中的几个关键步骤：</p>
<ol>
<li><code>Employee=Person:new()</code>，这里调用的是<code>Person</code>的方法，所以隐式传入的<code>self</code>指向的是<code>Person</code>，方法返回一个<code>obj</code>，这个<code>obj</code>的<code>metatable</code>的<code>__index</code>指向了<code>Person</code>（这里<code>self</code>是<code>Person</code>）。因为我们没有传入其它参数，所以<code>Employee</code>指向的是一个空的<code>table</code>，但是“继承”了<code>Person</code></li>
<li><code>e=Employee:new()</code>，<code>Employee</code>先去调用<code>new</code>方法，发现自身并没有这个方法，然后通过<code>metatalbe</code>指定<code>__index</code>属性去它的“原型”里面查找，找到了<code>Person</code>里的<code>new</code>方法，并使用这个方法。值得注意的是，调用<code>new</code>方法时隐式传入的<code>self</code>对象是<code>Employee</code>而不是<code>Person</code>,因为我们就是在<code>Employee</code>上调用的<code>new</code>方法，只是它通过“继承”获取到了方法,这一步返回一个空的<code>table</code>，但是它“继承”了<code>Employee</code>。</li>
<li><code>e:add(100)</code>，跟上面类似，先查找<code>Employee</code>，发现没有<code>add</code>方法，然后查找<code>Person</code>，找到后调用，此时传入的<code>self</code>是<code>e</code>本身，调用方法时发现自身还没有<code>money</code>这个属性，继续往上查找，找到<code>Person</code>的<code>money</code>，值是<code>100</code>,然后相加，得<code>200</code></li>
</ol>

    </div>

    
    

    <div class="post-footer">
        
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;hui-su-backtracking&#x2F;">‹ 回溯(backtracking)</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;spring-bootqi-dong-liu-cheng&#x2F;">Spring Boot启动流程 ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.fewth.com&#x2F;even.js" ></script>
      
    </body>

</html>
