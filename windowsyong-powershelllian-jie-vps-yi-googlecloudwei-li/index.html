<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title> - Windows用PowerShell连接VPS(以GoogleCloud为例）</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">

          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy" crossorigin="anonymous"></script>
              
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
                  onload="renderMathInElement(document.body);"></script>
              
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;site.css">
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Even</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.fewth.com">Even</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://www.fewth.com/windowsyong-powershelllian-jie-vps-yi-googlecloudwei-li/#1-ben-ji-sheng-cheng-key-ru-guo-yi-jing-you-key-ke-yi-tiao-guo" class="toc-link">1.本机生成key(如果已经有key，可以跳过)</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/windowsyong-powershelllian-jie-vps-yi-googlecloudwei-li/#2-dan-ge-fu-wu-qi-she-zhi" class="toc-link">2.单个服务器设置</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/windowsyong-powershelllian-jie-vps-yi-googlecloudwei-li/#2-1fu-zhi-gong-yao-dao-fu-wu-qi" class="toc-link">2.1复制公钥到服务器</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/windowsyong-powershelllian-jie-vps-yi-googlecloudwei-li/#2-2zhong-qi-sshdfu-wu" class="toc-link">2.2重启sshd服务</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/windowsyong-powershelllian-jie-vps-yi-googlecloudwei-li/#2-3jian-li-lian-jie" class="toc-link">2.3建立连接</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/windowsyong-powershelllian-jie-vps-yi-googlecloudwei-li/#3-quan-bu-shi-li-tong-yong-lian-jie-she-zhi-tui-jian" class="toc-link">3.全部实例通用连接设置(推荐)</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/windowsyong-powershelllian-jie-vps-yi-googlecloudwei-li/#4-qi-ta" class="toc-link">4.其它</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;windowsyong-powershelllian-jie-vps-yi-googlecloudwei-li&#x2F;">Windows用PowerShell连接VPS(以GoogleCloud为例）</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2020-07-28</span>
            
        </div>
    </header>

    <div class="post-content">
      <blockquote>
<p>Powershell已经内置OpenSSH,用起来比Xshell还方便，并且用root账号或开启密码登陆都存在安全隐患，所以这里只介绍普通用户+ssh的登陆方式。</p>
</blockquote>
<p>基本步骤：</p>
<!--more-->
<h2 id="1-ben-ji-sheng-cheng-key-ru-guo-yi-jing-you-key-ke-yi-tiao-guo">1.本机生成key(如果已经有key，可以跳过)</h2>
<p>打开<code>powershell</code>,输入:</p>
<p><code>ssh-keygen</code></p>
<p>一路enter,生成的秘钥默认位置在<code>~\.ssh\</code>下，即<code>C:\Users\xxx\.ssh</code>，xxx为你的windows用户名。</p>
<h2 id="2-dan-ge-fu-wu-qi-she-zhi">2.单个服务器设置</h2>
<p>这种方法是对单个服务器写入pub-key，更适合授权给别人访问的时候使用，对方把pub-key给你，你写到自己的服务器里面，对方就可以连接你的服务器了。</p>
<h3 id="2-1fu-zhi-gong-yao-dao-fu-wu-qi">2.1复制公钥到服务器</h3>
<ul>
<li>
<p>打开本地<code>~\.ssh\</code>目录下的.pub公钥文件，复制内容。</p>
</li>
<li>
<p>打开GCP控制面板，进入虚拟机实例管理页面，点击实例右边的连接下方的“SSH”，选择在浏览器窗口中打开。</p>
</li>
<li>
<p><strong>请记住打开的shell这里显示的用户名</strong></p>
</li>
<li>
<p>进入用户目录下的<code>.ssh</code>文件夹：<code>cd ~/.ssh/</code></p>
</li>
<li>
<p>编辑<code>authorized_keys</code>文件,</p>
<p><code>vi authorized_keys</code></p>
<p>添加刚才复制的公钥，文件中可以用#开头添加注释，注意不要把公钥给注释了。保存退出。</p>
</li>
</ul>
<blockquote>
<p>注意：如果没有<code>.ssh</code>文件夹，或者是通过root账号新增的用户，需要手动新增一个文件夹，并设置文件夹权限为<code>700</code>（<code>chmod 700 .ssh</code>)，新增<code>authorized_keys</code>文件并设置权限为600或700（<code>chmod 600 authorized_keys</code>）（如果不新增key，连接时只要对该文件有读权限就可以，也就是400），权限不对的话后面连接会被服务器拒绝，每次都要输入密码。这里权限设置可以理解为只有用户自己才能操作这个文件夹，即使同组内用户也不能访问，更别说其它一般用户了，否则就有安全问题。</p>
</blockquote>
<h3 id="2-2zhong-qi-sshdfu-wu">2.2重启sshd服务</h3>
<p><code>sudo service sshd restart</code></p>
<p>到这里先保留网页端，后面也许还用的到。</p>
<h3 id="2-3jian-li-lian-jie">2.3建立连接</h3>
<p>完成后就可以在powershell输入</p>
<p><code>ssh username@myServerIP</code></p>
<p>直接连接主机了，这里的<code>username</code>就是上面gcp打开的shell中显示的用户名。</p>
<p><strong>注意：如果服务器的IP以前已经连接过，记得到本机<code>~\.ssh\known_hosts</code>(跟pub-key同目录)文件中删除该IP对应的那一行，不然的话会因为跟之前的记录冲突而导致无法建立连接。</strong></p>
<p>如果连不上，可以返回刚才的网页端重启服务器</p>
<p><code>sudo reboot</code></p>
<h2 id="3-quan-bu-shi-li-tong-yong-lian-jie-she-zhi-tui-jian">3.全部实例通用连接设置(推荐)</h2>
<p>这种方法通过把pub-key写到gcp面板的设置里面，以后你的每个实例在创建的时候都会自动写入这个pub-key，就可以直接用<code>ssh username@hostname</code>的方式连接了，适合所有实例都是自己一个人用的情况。</p>
<p>主要步骤：</p>
<ul>
<li>
<p>在gcp面板上的搜索栏直接搜索<code>metadata</code>，中文应该是<code>元数据</code>，点进去之后再选择<code>ssh keys</code>选项卡。</p>
</li>
<li>
<p>打开本机<code>~\.ssh\</code>目录下的.pub公钥文件，复制内容，添加到上面的<code>ssh keys</code>里面，保存。</p>
</li>
<li>
<p>添加以后会自动生成一个用户名，比如<code>username</code>，然后在本机就可以用<code>ssh username@hostname</code>的方式连接了。</p>
</li>
</ul>
<p><strong>注意：如果服务器的IP以前已经连接过，记得到本机<code>~\.ssh\known_hosts</code>(跟pub-key同目录)文件中删除该IP对应的那一行，不然的话会因为跟之前的记录冲突而导致无法建立连接。</strong></p>
<h2 id="4-qi-ta">4.其它</h2>
<ul>
<li>google cloud默认是没有设置root密码的，连上以后可以<code>sudo passwd</code>第一时间设置密码，增加安全性。</li>
<li>如果账号下的实例都是自己用，推荐使用第二种方法，设置一次以后无论创建多少次实例，都不用再设置key。</li>
<li>还可以在powershell中配置别名等，进一步简化登陆步骤。</li>
<li>第一种方法对任意服务器都是通用的，而第二种则需要厂商的支持。</li>
</ul>

    </div>

    
    

    <div class="post-footer">
        
            
            
                <div class="post-nav">
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;javascriptzhong-proto-he-prototypede-qu-bie&#x2F;">Javascript中__proto__和prototype的区别 ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.fewth.com&#x2F;even.js" ></script>
      
    </body>

</html>
