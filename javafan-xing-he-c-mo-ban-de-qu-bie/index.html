<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title> - JAVA泛型和C++模板的区别</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">

          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy" crossorigin="anonymous"></script>
              
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
                  onload="renderMathInElement(document.body);"></script>
              
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;site.css">
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Even</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.fewth.com">Even</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#1-javade-fan-xing-generic-type" class="toc-link">1 Java的泛型(Generic Type)</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#1-1-wei-shi-yao-yao-shi-yong-fan-xing" class="toc-link">1.1 为什么要使用泛型</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#1-2-fan-xing-shi-xian-lei-xing-ca-chu" class="toc-link">1.2 泛型实现--类型擦除</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#1-3-fan-xing-de-yi-xie-xian-zhi" class="toc-link">1.3 泛型的一些限制</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#2-c-mo-ban-template" class="toc-link">2 C++模板（template)</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#2-1-mo-ban-yu-fa" class="toc-link">2.1 模板语法</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#3-qu-bie" class="toc-link">3 区别</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#3-1bian-yi-jie-duan-de-chu-li-fang-shi-bu-tong" class="toc-link">3.1编译阶段的处理方式不同</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#3-2ke-yi-jie-shou-de-can-shu-bu-tong" class="toc-link">3.2可以接收的参数不同</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#3-3-xiao-lu-bu-tong" class="toc-link">3.3 效率不同</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/javafan-xing-he-c-mo-ban-de-qu-bie/#4-zong-jie" class="toc-link">4 总结</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;javafan-xing-he-c-mo-ban-de-qu-bie&#x2F;">JAVA泛型和C++模板的区别</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2021-03-26</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>主要介绍java泛型，再与C++模板作一个简单的比较。</p>
<!--more-->
<h2 id="1-javade-fan-xing-generic-type">1 Java的泛型(Generic Type)</h2>
<p>Java泛型基于类型擦除，使用了泛型的代码在编译后看不到“泛型语法”，泛型可以理解为语法糖，是写给编译器看的，虚拟机里没有泛型的概念。</p>
<h3 id="1-1-wei-shi-yao-yao-shi-yong-fan-xing">1.1 为什么要使用泛型</h3>
<p><code>java</code>设计之初并没有泛型，比如，在<code>jdk1.5</code>以前，<code>ArrayList</code>操作的对象都是<code>Object</code>，使用时需要进行手动转换。</p>
<p>举个例子，我们构造一个数组，用来保存<code>String</code>类型的字符串，然后打印每一个字符串的长度：</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">java.util.</span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#c0c5ce;">;

</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">Demo </span><span style="color:#eff1f5;">{
    </span><span style="color:#b48ead;">public static void </span><span style="color:#8fa1b3;">main</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[] </span><span style="color:#bf616a;">args</span><span style="color:#eff1f5;">) {
        </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;"> arr</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">();
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">1</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">22</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">333</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
        </span><span style="color:#b48ead;">for</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;"> i</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">;i</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#eff1f5;">arr.</span><span style="color:#bf616a;">size</span><span style="color:#eff1f5;">();i</span><span style="color:#c0c5ce;">++</span><span style="color:#eff1f5;">){
            </span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;"> str</span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">)arr.</span><span style="color:#bf616a;">get</span><span style="color:#eff1f5;">(i);</span><span style="color:#65737e;">//对取出的元素执行转换，Object-&gt;String
            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">第</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#eff1f5;">(i</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">)</span><span style="color:#c0c5ce;">+&quot;</span><span style="color:#a3be8c;">个字符串的长度是：</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#eff1f5;">str.</span><span style="color:#bf616a;">length</span><span style="color:#eff1f5;">());
        }
    }
}
</span></code></pre>
<p>输出结果：</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">第1个字符串的长度是：1
第2个字符串的长度是：2
第3个字符串的长度是：3
</span></code></pre>
<p>然后我们再往数组中添加一个元素，但是输入数据时少打了个双引号，原本想要输入字符串却输入了一个整数：</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">java.util.</span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#c0c5ce;">;

</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">Demo </span><span style="color:#eff1f5;">{
    </span><span style="color:#b48ead;">public static void </span><span style="color:#8fa1b3;">main</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[] </span><span style="color:#bf616a;">args</span><span style="color:#eff1f5;">) {
        </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;"> arr</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">();
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">1</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">22</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">333</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">4444</span><span style="color:#eff1f5;">);</span><span style="color:#65737e;">//忘记了双引号，添加了一个整数
        </span><span style="color:#b48ead;">for</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;"> i</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">;i</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#eff1f5;">arr.</span><span style="color:#bf616a;">size</span><span style="color:#eff1f5;">();i</span><span style="color:#c0c5ce;">++</span><span style="color:#eff1f5;">){
            </span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;"> str</span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">)arr.</span><span style="color:#bf616a;">get</span><span style="color:#eff1f5;">(i);</span><span style="color:#65737e;">//对取出的元素执行转换，Object-&gt;String
            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">第</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#eff1f5;">(i</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">)</span><span style="color:#c0c5ce;">+&quot;</span><span style="color:#a3be8c;">个字符串的长度是：</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#eff1f5;">str.</span><span style="color:#bf616a;">length</span><span style="color:#eff1f5;">());
        }
    }
}
</span></code></pre>
<p>重新运行这段代码，输出结果：</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#c0c5ce;">第1个字符串的长度是：</span><span style="color:#d08770;">1
</span><span style="color:#c0c5ce;">第2个字符串的长度是：</span><span style="color:#d08770;">2
</span><span style="color:#c0c5ce;">第3个字符串的长度是：</span><span style="color:#d08770;">3
</span><span style="color:#ebcb8b;">Exception</span><span style="color:#c0c5ce;"> in thread &quot;</span><span style="color:#a3be8c;">main</span><span style="color:#c0c5ce;">&quot; java.lang.</span><span style="color:#ebcb8b;">ClassCastException</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">java</span><span style="color:#c0c5ce;">.lang.</span><span style="color:#ebcb8b;">Integer</span><span style="color:#c0c5ce;"> cannot be cast to </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">java</span><span style="color:#c0c5ce;">.lang.</span><span style="color:#ebcb8b;">String </span><span style="color:#c0c5ce;">(java.lang.</span><span style="color:#ebcb8b;">Integer</span><span style="color:#c0c5ce;"> and java.lang.</span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;"> are in module java.base of loader &#39;</span><span style="color:#a3be8c;">bootstrap</span><span style="color:#c0c5ce;">&#39;)
	at </span><span style="color:#ebcb8b;">Demo</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">main</span><span style="color:#c0c5ce;">(</span><span style="color:#ebcb8b;">Demo</span><span style="color:#c0c5ce;">.java:</span><span style="color:#d08770;">11</span><span style="color:#c0c5ce;">)
</span></code></pre>
<p>从结果可以看到，在循环运行时，前面3次都正确打印出了结果，而到第4次执行到第11行-类型转换时出错了，因为我们在对应位置存储的是一个整数，而不是字符串，这是一个<code>运行时错误（RuntimeException)</code>。</p>
<p>通过上面的例子，我们可以看到“手动转换”来保证类型正确的弊端：</p>
<ul>
<li>每次取出数据都要手动转换，这一点在编译时可以检查</li>
<li>没法在编译时检查数据输入的合法性，一旦出错，就是<code>RuntimeException</code></li>
</ul>
<p>引入泛型以后，上面的例子就简单多了：</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">java.util.</span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#c0c5ce;">;

</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">Demo </span><span style="color:#eff1f5;">{
    </span><span style="color:#b48ead;">public static void </span><span style="color:#8fa1b3;">main</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[] </span><span style="color:#bf616a;">args</span><span style="color:#eff1f5;">) {
        </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">&gt; arr</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;&gt;();
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">1</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">22</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
        arr.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">333</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#65737e;">//        arr.add(4444); //编译时会进行类型检查，报错：java: incompatible types: int cannot be converted to java.lang.String
        </span><span style="color:#b48ead;">for</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;"> i</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">;i</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#eff1f5;">arr.</span><span style="color:#bf616a;">size</span><span style="color:#eff1f5;">();i</span><span style="color:#c0c5ce;">++</span><span style="color:#eff1f5;">){
            </span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;"> str</span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;">arr.</span><span style="color:#bf616a;">get</span><span style="color:#eff1f5;">(i);</span><span style="color:#65737e;">//无需类型转换，直接就是String
            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">第</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#eff1f5;">(i</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">)</span><span style="color:#c0c5ce;">+&quot;</span><span style="color:#a3be8c;">个字符串的长度是：</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#eff1f5;">str.</span><span style="color:#bf616a;">length</span><span style="color:#eff1f5;">());
        }
    }
}
</span></code></pre>
<p>泛型让你的代码简单又可靠。</p>
<h3 id="1-2-fan-xing-shi-xian-lei-xing-ca-chu">1.2 泛型实现--类型擦除</h3>
<p>泛型在编译的时候，具体的类型参数会被擦除，取而代之的是它的<strong>第一个</strong>“限定类型”，也就是其继承的类或者实现的接口，如果都没有的话，自然就是<code>Object</code>类了。编译器会在编译时检查你的代码，如果有错误的类型转换出现（如给泛型<code>List</code>添加一个错误类型的对象或者把从<code>List</code>取出的对象赋值给一个错误类型的变量），则会报错，无法通过编译。所以<strong>泛型实际上是把运行时的类型转换检查提前到了编译时，避免运行时异常</strong>。</p>
<p>所以，在判断泛型所属类型的时候，不管你传入参数的是什么类型，泛型始终都是同一个类型：</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">java.util.</span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#c0c5ce;">;

</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">Demo </span><span style="color:#eff1f5;">{
    </span><span style="color:#b48ead;">public static void </span><span style="color:#8fa1b3;">main</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[] </span><span style="color:#bf616a;">args</span><span style="color:#eff1f5;">) {
        </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">&gt; arr</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;&gt;();
        </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">Integer</span><span style="color:#eff1f5;">&gt; arrInt</span><span style="color:#c0c5ce;">=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;&gt;();
        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(arr.</span><span style="color:#bf616a;">getClass</span><span style="color:#eff1f5;">()</span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;">arrInt.</span><span style="color:#bf616a;">getClass</span><span style="color:#eff1f5;">());</span><span style="color:#65737e;">//true
    </span><span style="color:#eff1f5;">}
}
</span></code></pre>
<blockquote>
<p>PS:虽然进行了“类型擦除”，<code>class</code>文件中仍然有关于被擦除类型的信息，被保存在<code>LocalVariableTypeTable</code>中。</p>
</blockquote>
<p>关于“限定类”，有几点要注意：</p>
<ul>
<li>可以是一个或者多个&quot;限定类型&quot;,但是最多只能有一个是类，其它的必须是接口，这跟类继承是一样的，但是用<code>&amp;</code>符号连接，因为逗号用来分隔不同的类型参数</li>
<li>如果有一个是类，那么类写在第一个位置，如<code>&lt;T extends ClassA&amp;InterfaceB&amp;InterfaceC&gt;</code></li>
<li>如果全部是接口，把最复杂的接口写在最前面可以提高效率。因为类型擦除是转换成第一个&quot;限定类型&quot;，如果第一个只是一个标记接口，那么后面用到其它接口的地方，还要再加入强制转换。</li>
</ul>
<h3 id="1-3-fan-xing-de-yi-xie-xian-zhi">1.3 泛型的一些限制</h3>
<p>泛型有一些应用限制，其中一部分就是因为类型擦除。</p>
<ul>
<li>不能传入8大原始类型。<code>int,short,long,byte,boolean,double,float,char</code></li>
<li>泛型中的类型参数不能被实例化，但是可以通过反射，用<code>Class&lt;T&gt;</code>的<code>newInstance()</code>方法获得实例(<strong><code>JDK9</code>以后官方推荐用<code>Class&lt;T&gt;.getDeclaredConstructor().newInstance()</code></strong>)</li>
<li>泛型中的类型参数不能被声明为静态的</li>
<li>不能对带有类型参数的泛型表达式使用<code>instance of</code>，（大部分时候）也不能进行类型转换</li>
<li>不能创建泛型数组，<code>Object[] stringLists = new List&lt;String&gt;[];  // compiler error</code></li>
<li>泛型类不能继承异常类型，如<code>AException&lt;T&gt; extends Throwable//compile error</code>，也不能捕捉T，但是可以<code>throws T</code></li>
<li>不能重载一个仅仅是泛型参数类型不同的方法，因为类型擦除后，他们是一样的。</li>
</ul>
<h2 id="2-c-mo-ban-template">2 C++模板（template)</h2>
<p>c++的模板就跟它的名字一样，定义的时候它是一个模板，后面使用时，编译器会把模板中的类型替换为具体的类型，生成一份“根据模板制作”的代码。c++有两种模板，类模板和函数模板，模板本身不是类或函数，可以理解创建类或函数的公式。</p>
<h3 id="2-1-mo-ban-yu-fa">2.1 模板语法</h3>
<p>以函数模板举例：</p>
<pre style="background-color:#2b303b;">
<code class="language-cpp" data-lang="cpp"><span style="color:#65737e;">//定义模板
</span><span style="color:#b48ead;">template </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#b48ead;">typename</span><span style="color:#c0c5ce;"> T&gt;
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">compare</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const</span><span style="color:#c0c5ce;"> T &amp;</span><span style="color:#bf616a;">v1</span><span style="color:#c0c5ce;">,</span><span style="color:#b48ead;">const</span><span style="color:#c0c5ce;"> T &amp;</span><span style="color:#bf616a;">v2</span><span style="color:#c0c5ce;">){
    </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;">(v1 &lt; v2) </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
    </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;">(v2 &lt; v1) </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
    </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0
</span><span style="color:#c0c5ce;">}

</span><span style="color:#65737e;">//使用模板
</span><span style="color:#c0c5ce;">cout&lt;&lt; </span><span style="color:#bf616a;">compare</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">) &lt;&lt;endl;
</span><span style="color:#65737e;">//在上面的调用中，编译器会自动为函数模板推断类型为int，并生成下面的代码
</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> compare（</span><span style="color:#b48ead;">const int </span><span style="color:#c0c5ce;">&amp;v1,</span><span style="color:#b48ead;">const int </span><span style="color:#c0c5ce;">&amp;v2</span><span style="background-color:#bf616a;color:#2b303b;">)</span><span style="color:#c0c5ce;">{
    </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;">(v1 &lt; v2) </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
    </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;">(v2 &lt; v1) </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
    </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0
</span><span style="color:#c0c5ce;">}

</span></code></pre><h2 id="3-qu-bie">3 区别</h2>
<h3 id="3-1bian-yi-jie-duan-de-chu-li-fang-shi-bu-tong">3.1编译阶段的处理方式不同</h3>
<p>java 在编译时直接把泛型中的类型参数擦除，并在需要地方插件强制类型转换。而c++在编译到模板定义的代码时，并没有任何操作，只在使用到这份模板代码时，根据实际类型，为这个类型生成一份特定的代码。这一点其实是本质区别，后面的几点区别都是因为这个。</p>
<h3 id="3-2ke-yi-jie-shou-de-can-shu-bu-tong">3.2可以接收的参数不同</h3>
<p>java 泛型不能接收8大原始类型，c++没有这个限制。java在类型擦除时，把类型“退化”成它的限定类型，而原始类型比较特殊，无法“退化”成<code>Object</code>。java可以接收通配符，c++不能。c++不能接收类型限定，虽然可以通过其它手段，如<code>c++20</code>的<code>concept</code>来实现类似的功能。</p>
<h3 id="3-3-xiao-lu-bu-tong">3.3 效率不同</h3>
<p>java的类型擦除会增加很多类型转换的操作，效率低下。而c++模板生成一份特定类型的代码，这跟你自己手写一份和“模板”逻辑一样的代码没有什么区别。</p>
<h2 id="4-zong-jie">4 总结</h2>
<p>java选择这种看起来缺点很多的泛型实现方式，根本原因就是为了一个优点“兼容性”。java泛型和c++模板本质上还是差别挺大的，c++的模板像宏，java泛型像语法糖。</p>

    </div>

    
    

    <div class="post-footer">
        
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;javanei-bu-lei-he-qian-tao-jie-kou&#x2F;">‹ Java内部类和嵌套接口</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;windowsyong-dockerbu-shu-redisji-qun&#x2F;">Windows用Docker部署Redis集群 ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.fewth.com&#x2F;even.js" ></script>
      
    </body>

</html>
