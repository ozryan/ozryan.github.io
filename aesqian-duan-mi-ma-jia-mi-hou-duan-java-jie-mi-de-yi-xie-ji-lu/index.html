<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title> - AES前端密码加密后端(java)解密的一些记录</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">

          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy" crossorigin="anonymous"></script>
              
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
                  onload="renderMathInElement(document.body);"></script>
              
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;site.css">
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Even</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.fewth.com">Even</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://www.fewth.com/aesqian-duan-mi-ma-jia-mi-hou-duan-java-jie-mi-de-yi-xie-ji-lu/#huan-jing" class="toc-link">环境</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/aesqian-duan-mi-ma-jia-mi-hou-duan-java-jie-mi-de-yi-xie-ji-lu/#jia-mi-fang-fa-mode-paddingde-xuan-ze" class="toc-link">加密方法、MODE、PADDING的选择</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/aesqian-duan-mi-ma-jia-mi-hou-duan-java-jie-mi-de-yi-xie-ji-lu/#shi-xian-gong-ju-lei" class="toc-link">实现工具类</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://www.fewth.com/aesqian-duan-mi-ma-jia-mi-hou-duan-java-jie-mi-de-yi-xie-ji-lu/#qian-duan" class="toc-link">前端</a>
                        </li>
                        
                        <li>
                            <a href="https://www.fewth.com/aesqian-duan-mi-ma-jia-mi-hou-duan-java-jie-mi-de-yi-xie-ji-lu/#hou-duan" class="toc-link">后端</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/aesqian-duan-mi-ma-jia-mi-hou-duan-java-jie-mi-de-yi-xie-ji-lu/#ying-yong" class="toc-link">应用</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;aesqian-duan-mi-ma-jia-mi-hou-duan-java-jie-mi-de-yi-xie-ji-lu&#x2F;">AES前端密码加密后端(java)解密的一些记录</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2020-09-08</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>本文主要讲前端传输时的密码加密及后端收到密文后解密的过程，避免明文传输密码，文中内容都比较浅显，加密原理部分需要查阅其它资料。至于前端加密是否有意义，见仁见智。</p>
<h2 id="huan-jing">环境</h2>
<p>前端用的<code>vue</code>，纯JS也可以，引入<code>crypto-js</code>库，后端用<code>java</code>。</p>
<h2 id="jia-mi-fang-fa-mode-paddingde-xuan-ze">加密方法、MODE、PADDING的选择</h2>
<p>这几个参数之间相互有关联，且前后端加密、解密时的参数必须一致。</p>
<p>有的参数前端有A选项，但是后端没有对应的选项，反之也存在后端有B选项，但前端没有的，选择的时候只能选前后端都有的。</p>
<p>具体可以从下面两篇文档中看到：</p>
<ul>
<li>
<p><a href="https://cryptojs.gitbook.io/docs/#pbkdf2">前端cypto-js参考文档</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html">后端java参考文档</a></p>
</li>
</ul>
<p>三个参数前后端共有的选项分别是：</p>
<ul>
<li>加密方法：<code>AES</code>、<code>DES</code>、 <code>Triple DES</code>(java对应<code>DESede</code>)、<code>RC4</code></li>
<li>mode：<code>CBC</code>、<code>CFB</code>、<code>CTR</code>、<code>OFB</code>、<code>ECB</code></li>
<li>padding:<code>NoPadding</code>、<code>Iso10126</code>、<code>Pkcs7 </code>(java对应<code>PKCS5Padding</code>)</li>
</ul>
<!--more-->
<p>选择的话,每一个方法、MODE、padding的实现都有点复杂，上面的java参考文档里有写具体的技术性文档链接，这里只说使用，不说原理。</p>
<ul>
<li>加密方法通常选<code>AES</code>，参考：<a href="https://csrc.nist.gov/publications/fips/fips197/fips-197.pdf">FIPS 197</a>。</li>
<li>mode: <code>crypto-js</code>默认是<code>CBC</code>，参考：<a href="https://csrc.nist.gov/publications/fips/fips81/fips81.htm">FIPS 81</a></li>
<li>padding：如果上面选的是<code>AES/CBC</code>,那么<code>padding</code>可以选<code>Iso10126</code>或者<code>Pkcs7</code>。
<ul>
<li><font color="red">NoPadding不能用</font>，因为AES只支持128bit、192bit、256bit几种大小的分块(block)，取决于key的位数，除非要加密的密文正好是上面这个块的大小，否则就不能解密，这显然是不合理的。</li>
<li>前端的<code>Pkcs7</code>和java的<code>PKCS5Padding</code>是对应的，参考<a href="https://en.wikipedia.org/wiki/Padding_(cryptography)">wiki</a>上的解释,两者基本等价：
&gt;PKCS#5 padding is identical to PKCS#7 padding, except that it has only been defined for block ciphers that use a 64-bit (8-byte) block size. In practice the two can be used interchangeably.</li>
</ul>
</li>
</ul>
<h2 id="shi-xian-gong-ju-lei">实现工具类</h2>
<p>下面的例子采用<code>AES/CBC/Pkcs7</code>这几项，java端是<code>AES/CBC/PKCS5Padding</code>。</p>
<p>密钥<code>key</code>和初始向量<code>iv</code>都设置成固定值，前后端一致即可。</p>
<p><code>key</code>用于<code>AES</code>方法加密，<code>iv</code>用于<code>CBC</code>MODE，<code>iv</code>的大小要跟<code>block</code>一样，在这里就是128bit，跟<code>key</code>一样</p>
<p>前端引入<code>crypto-js</code>：<code>npm install crypto-js</code></p>
<h3 id="qian-duan">前端</h3>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#65737e;">//aesutils.js
</span><span style="color:#b48ead;">import </span><span style="color:#bf616a;">CryptoJs </span><span style="color:#b48ead;">from </span><span style="color:#c0c5ce;">&#39;</span><span style="color:#a3be8c;">crypto-js</span><span style="color:#c0c5ce;">&#39;

</span><span style="color:#65737e;">//把key、iv设置成固定值，前后端的值要一致
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">key </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">CryptoJs</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">enc</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Utf8</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">parse</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">onlinemenukey123</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">iv </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">CryptoJs</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">enc</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Utf8</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">parse</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">onlinemenuiv1234</span><span style="color:#c0c5ce;">&quot;);

</span><span style="color:#65737e;">/**
 *
 * </span><span style="color:#b48ead;">@param </span><span style="color:#bf616a;">word</span><span style="color:#65737e;"> 原始文本
 * </span><span style="color:#b48ead;">@returns </span><span style="color:#65737e;">{*} Base64的文本
 * </span><span style="color:#b48ead;">@constructor
 </span><span style="color:#65737e;">*/
</span><span style="color:#b48ead;">export function </span><span style="color:#8fa1b3;">Encrypt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">word</span><span style="color:#c0c5ce;">) {
    </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">srcs </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">CryptoJs</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">enc</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Utf8</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">parse</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">word</span><span style="color:#c0c5ce;">);
    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">encrypted </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">CryptoJs</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">AES</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">encrypt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">srcs</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">, {
        iv: </span><span style="color:#bf616a;">iv</span><span style="color:#c0c5ce;">,
        mode: </span><span style="color:#bf616a;">CryptoJs</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mode</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">CBC</span><span style="color:#c0c5ce;">,
        padding: </span><span style="color:#bf616a;">CryptoJs</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">pad</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Pkcs7
    </span><span style="color:#c0c5ce;">});
    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">CryptoJs</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">enc</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Base64</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">stringify</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">encrypted</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">ciphertext</span><span style="color:#c0c5ce;">);
}
</span></code></pre><h3 id="hou-duan">后端</h3>
<p>涉及到<code>String</code>和<code>byte[]</code>转换时，最好指定编码类型，可以避免</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#b48ead;">package </span><span style="color:#c0c5ce;">com.lyuww.bgmanager.Utils;

</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">org.apache.tomcat.util.codec.binary.</span><span style="color:#ebcb8b;">Base64</span><span style="color:#c0c5ce;">;

</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">javax.crypto.</span><span style="color:#ebcb8b;">Cipher</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">javax.crypto.spec.</span><span style="color:#ebcb8b;">IvParameterSpec</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">javax.crypto.spec.</span><span style="color:#ebcb8b;">SecretKeySpec</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">java.nio.charset.</span><span style="color:#ebcb8b;">StandardCharsets</span><span style="color:#c0c5ce;">;

</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">AESUtils </span><span style="color:#eff1f5;">{
    </span><span style="color:#65737e;">/**
     * 解密前端发送的AES加密处理后的密码文本
     * </span><span style="color:#b48ead;">@param </span><span style="color:#bf616a;">text</span><span style="color:#65737e;"> 前端发送的加密后的密文
     * </span><span style="color:#b48ead;">@param </span><span style="color:#bf616a;">key</span><span style="color:#65737e;"> 跟前端设置的key一致,只能是128bit、192bit、256bit
     * </span><span style="color:#b48ead;">@param </span><span style="color:#bf616a;">iv</span><span style="color:#65737e;"> 初始向量，跟前端设置的iv一致
     * </span><span style="color:#b48ead;">@return
     </span><span style="color:#65737e;">*/

    private static final String key=&quot;onlinemenukey123&quot;;
    private static final String iv=&quot;onlinemenuiv1234&quot;;


    public static String DecoderAES(String text){
        try{
            byte[] encrypted=new Base64().decode(text);//把base64编码的文本转换成byte数组

            Cipher cipher=Cipher.getInstance(&quot;AES/CBC/PKCS5Padding &quot;);
            SecretKeySpec secretKey=new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8),&quot;AES&quot;);
            IvParameterSpec ivParameter=new IvParameterSpec(iv.getBytes(StandardCharsets.UTF_8));

            cipher.init(Cipher.DECRYPT_MODE,secretKey,ivParameter);

            byte[] decrypted=cipher.doFinal(encrypted);
            String oriringalString=new String(decrypted,StandardCharsets.UTF_8);
            return oriringalString;
        }catch (Exception e){
            //解密失败时的操作
            return e.toString();
        }
    }
}
</span></code></pre><h2 id="ying-yong">应用</h2>
<p>主要步骤：</p>
<p>前端</p>
<ul>
<li>
<p>引入工具类：</p>
<p><code>import {Decrypt, Encrypt} from &quot;@/utils/aesutils&quot;;</code></p>
</li>
<li>
<p>用<code>axios</code>等方法传输数据，比如密码，在传输前加工具类加密即可</p>
<p><code>Encrypt(this.$data.formData.password)</code></p>
</li>
</ul>
<p>后端</p>
<ul>
<li>
<p>引入工具类</p>
<p><code>import xxx.AESUtils;</code></p>
</li>
<li>
<p>用工具类解密还原密码，然后进行后续的数据库端密码操作即可</p>
<p><code>AESUtils.DecoderAES(user.getPassword()))</code></p>
</li>
</ul>

    </div>

    
    

    <div class="post-footer">
        
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;vue-element-ui-shi-xian-dan-chuang-deng-lu&#x2F;">‹ vue+element-ui 不借助vuex实现弹窗登录</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;hou-duan-chu-li-shu-ju-ge-shi-yan-zheng-ji-tong-yi-chu-li-yi-chang&#x2F;">后端处理数据格式验证及统一处理异常 ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.fewth.com&#x2F;even.js" ></script>
      
    </body>

</html>
