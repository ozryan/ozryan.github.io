<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title> - 用Github-Actions自动化布署Hexo博客(从私有仓库到公共仓库)</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">

          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy" crossorigin="anonymous"></script>
              
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
                  onload="renderMathInElement(document.body);"></script>
              
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;site.css">
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Even</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.fewth.com">Even</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://www.fewth.com/yong-github-actionszi-dong-hua-bu-shu-hexobo-ke-cong-si-you-cang-ku-dao-gong-gong-cang-ku/#1-qian-ti" class="toc-link">1 前提</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/yong-github-actionszi-dong-hua-bu-shu-hexobo-ke-cong-si-you-cang-ku-dao-gong-gong-cang-ku/#2-chuang-jian-yi-ge-bei-fen-cang-ku" class="toc-link">2 创建一个备份仓库</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/yong-github-actionszi-dong-hua-bu-shu-hexobo-ke-cong-si-you-cang-ku-dao-gong-gong-cang-ku/#3-chuang-jian-github-actionsjiao-ben" class="toc-link">3 创建Github Actions脚本</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/yong-github-actionszi-dong-hua-bu-shu-hexobo-ke-cong-si-you-cang-ku-dao-gong-gong-cang-ku/#4-chuang-jian-he-she-zhi-mi-yao" class="toc-link">4 创建和设置秘钥</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/yong-github-actionszi-dong-hua-bu-shu-hexobo-ke-cong-si-you-cang-ku-dao-gong-gong-cang-ku/#5-xie-powershelljiao-ben-jin-yi-bu-jian-hua-cao-zuo" class="toc-link">5 写Powershell脚本进一步简化操作</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/yong-github-actionszi-dong-hua-bu-shu-hexobo-ke-cong-si-you-cang-ku-dao-gong-gong-cang-ku/#6-zong-jie" class="toc-link">6 总结</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;yong-github-actionszi-dong-hua-bu-shu-hexobo-ke-cong-si-you-cang-ku-dao-gong-gong-cang-ku&#x2F;">用Github-Actions自动化布署Hexo博客(从私有仓库到公共仓库)</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2021-06-08</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>常规的hexo使用方式如下：<br />
写markdown文件保存-&gt;<code>hexo generate</code>生成文件-&gt;<code>hexo deploy</code>部署到github仓库-&gt;把源文件备份到博客仓库的source分支或者备份到一个私有仓库</p>
<p>利用<code>Github-Actions</code>+<code>Powershell脚本</code>可以把写博客的流程简化为：<br />
写markdown文件保存-&gt;打开powershell，输入<code>pushhexo</code>指令完成上面的所有步骤</p>
<!--more-->
<h2 id="1-qian-ti">1 前提</h2>
<p>后面的所有内容都假设你已经能正常用<code>hexo deploy</code>布署博客，这表示你的环境已经满足下面几点要求：</p>
<ul>
<li>有github.io对应的仓库</li>
<li>安装了git且设置了秘钥，能执行常规操作</li>
</ul>
<h2 id="2-chuang-jian-yi-ge-bei-fen-cang-ku">2 创建一个备份仓库</h2>
<p>因为配置文件中有一些敏感信息，所以我选择创建一个<strong>私有仓库</strong>，过程不表，假设命名为<code>hexo</code>。<br />
这里要注意，如果我们安装了主题，并且是从github上clone下来的，那么主题文件夹中（比如themes/next/)会有名为<code>.git</code>的隐藏文件夹用于git同步，需要把它删除，因为我们备份到私有仓库的时候是把主题文件一起备份的(这样才能在自动化部署中保留主题)，嵌套的git仓库会报错，当然删除以后就不能用<code>git pull</code>的方式更新主题了。</p>
<p>把本地的博客文件夹上传到<code>hexo</code>私有仓库，并保证<code>.gitignore</code>文件中包含以下几项，<strong>避免</strong>以前手动生成及部署过的文件也作为源文件上传：</p>
<ul>
<li>node_modules/</li>
<li>public/</li>
<li>.deploy*/</li>
</ul>
<h2 id="3-chuang-jian-github-actionsjiao-ben">3 创建Github Actions脚本</h2>
<p>创建一个<code>.github/workflows/pages.yml</code>文件(没有目录就先创建目录），这里参考的<a href="https://hexo.io/docs/github-pages.html">hexo官方的脚本</a>并稍作修改：</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">name: Pages #脚本名称

on: push ＃在push这个操作发生的时候执行脚本，也可以指定分支，默认master

jobs:
  pages:
    runs-on: ubuntu-latest #虚拟环境
    steps:
      - uses: actions/checkout@v2 #uses指令就是用的其它的现成的脚本
      - name: Use Node.js 12.x ＃name只是提供一个名称
        uses: actions/setup-node@v1
        with:                     ＃可以用with提供参数信息
          node-version: &#39;12.x&#39;
      - name: Cache NPM dependencies
        uses: actions/cache@v2
        with:
          path: node_modules
          key: ${{ runner.OS }}-npm-cache
          restore-keys: |
            ${{ runner.OS }}-npm-cache
      - name: Install Dependencies
        run: npm install

      ＃上面的操作都是为了准备环境


      - name: Build ＃生成
        run: npm run build ＃这里需要保证你博客根目录下的package.json文件中有这个脚本，没有的话添加一下&quot;build&quot;: &quot;hexo generate&quot;
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3　＃这是一个自动化部署到github pages的脚本
        with:
          personal_token: ${{ secrets.HEXO_DEPLOY }} ＃HEXO_DEPLOY这个名称跟源文件仓库中设置的要对应
          external_repository: ozryan/ozryan.github.io  ＃添加部署的目标仓库，也就是github.io对应的仓库，由＂用户名／仓库名＂的方式指定
          publish_dir: ./public ＃需要发布的文件目录，hexo generate生成的就是./public
          publish_branch: master  # deploying branch 部署的分支，对应我们的external_repository
</span></code></pre>
<p>上面指令用注释进行了简单的说明，列一下需要修改的几个地方：
－ personal_token：如果设定的秘钥名称不是<code>HEXO_DEPLOY</code>，那么这里也需要修改
－ external_repository：改成你自己的源文件备份仓库</p>
<h2 id="4-chuang-jian-he-she-zhi-mi-yao">4 创建和设置秘钥</h2>
<p>我选择的是personal_token，生成方式用文字说明：
在github点击右上角头像-&gt;Settings-&gt;Developer settings-&gt;Personal access tokens-&gt;Generate new token，这里随便起一个名字就行，选上<code>repo</code>的所有权限和<code>workflow</code>权限，点击生成，复制秘钥，这个秘钥只显示一次，如果没有保存，重新生成一即可。</p>
<p>设置秘钥：
选择你备份源文件的私有仓库(hexo)-&gt;Settings-&gt;Secrets-&gt;New repository secret,这里命名为<code>HEXO_DEPLOY</code>，跟前面脚本中的名字对应，把秘钥内容复制进去保存。</p>
<h2 id="5-xie-powershelljiao-ben-jin-yi-bu-jian-hua-cao-zuo">5 写Powershell脚本进一步简化操作</h2>
<p>上面的步骤完成以后，我们仍然需要手动的执行<code>git add,git commit,git push</code>这些操作，这里借助<code>powershell</code>脚本实现简化。</p>
<p>先找开<code>powershell</code>，执行<code>$profile</code>,会显示配置文件位置，打开这个配置文件，添加下面的内容：</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">#hexo 备份到github
function pushhexo{
    $currpath=$pwd.path;
    $hexopath=&quot;C:\Users\xxx\Documents\GitHub\blog&quot;;
    Set-Location $hexopath;
    git add ./;
    git commit -m &quot;script backup&quot;;
    git push;
    Set-Location $currpath;
    Write-Output &quot;Push hexo files to github successfully&quot;;
}
</span></code></pre>
<p>其中<code>$hexopath=&quot;C:\Users\xxx\Documents\GitHub\blog&quot;;</code>这一行需要修改路径为你的博客根目录，保存后需要重启powershell才能生效。</p>
<p>到这里，我们就可以在<code>powershell</code>中输入<code>pushehxo</code>实现一键备份和部署了。</p>
<h2 id="6-zong-jie">6 总结</h2>
<p>用<code>Github Action</code>实现自动部署，不仅可以简化部署流程，还可以免去本地渲染的机器性能开销。在文章数量越来越多的时候（几百或者几千），hexo渲染就会越来越慢，甚至卡死，利用<code>Github Actions</code>的话，本地只需要负责io传输就行了，渲染由github完成。</p>

    </div>

    
    

    <div class="post-footer">
        
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;jvmzhi-classwen-jian-ji-lei-jia-zai-ji-zhi-he-shuang-qin-wei-pai-mo-xing&#x2F;">‹ JVM之class文件及类加载机制和双亲委派模型</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;hui-su-backtracking&#x2F;">回溯(backtracking) ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.fewth.com&#x2F;even.js" ></script>
      
    </body>

</html>
