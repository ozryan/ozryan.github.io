<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title> - 回溯(backtracking)</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">

          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy" crossorigin="anonymous"></script>
              
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
                  onload="renderMathInElement(document.body);"></script>
              
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;site.css">
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Even</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;www.fewth.com">Even</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://www.fewth.com/hui-su-backtracking/#1-jian-jie" class="toc-link">1 简介</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/hui-su-backtracking/#2-ji-ben-yao-su" class="toc-link">2 基本要素</a>
                    
                </li>
                
                <li>
                    <a href="https://www.fewth.com/hui-su-backtracking/#3-shi-li-nhuang-hou-wen-ti" class="toc-link">3 示例--N皇后问题</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;www.fewth.com&#x2F;hui-su-backtracking&#x2F;">回溯(backtracking)</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2021-06-23</span>
            
        </div>
    </header>

    <div class="post-content">
      <h2 id="1-jian-jie">1 简介</h2>
<p>回溯是一种算法思想，通常借助递归实现，核心就是记录相应的状态值，以降低&quot;试错成本&quot;。</p>
<!--more-->
<p>比如，在走迷宫时，我们记录每个叉路口的状态，当遍历完一个叉路口时，如果它的后续路线都是死胡同，那么可以直接回退到上一个还没有遍历完的叉路口，而不用从头开始。</p>
<p>跟DFS的关系？<br />
DFS是针对图形搜索的一种算法实现，通常里面都用到了回溯的思想。而可以用回溯解决的问题，经常也可以抽象出来一个&quot;树形结构&quot;（树也是图的一种）。</p>
<p>应用场景：<br />
如果一个问题，理论上可以通过暴力搜索解决，但是在暴力搜索的过程中会有很多重复操作，这时候可以优化的选择通常有两个，动态规划或者回溯，这两者本质上都是&quot;空间换时间&quot;，通过记录相应的状态值来节省操作时间，动态规划通常能降低一个数量级的时间复杂度，而回溯则是节省了被剪枝优化掉的操作的时间。用回溯解决的问题通常N值都不会太大(小于10)。</p>
<h2 id="2-ji-ben-yao-su">2 基本要素</h2>
<p>通常应用回溯的时候会借助递归函数，函数中应该包含下面几个要素：</p>
<ul>
<li>递归结束条件：一般在这里直接输出满足条件的结果，放在函数的最上面</li>
<li>剪枝操作（递归中断条件）：使其区别于暴力搜索的重要因素，理论上，没有剪枝操作的话，回溯跟暴力搜索的时间复杂度是一样的，还要多出递归中栈的空间开销。</li>
<li>中间状态的记录和恢复：在递归调用之前，应该记录结果的中间状态，在递归调用后恢复到这个状态。这里的中间状态指的是获取结果之前，在调用过程中生成的值，比如全排列问题中的未达到指定长度的字符串。</li>
<li>递归调用的参数，通常包含以下几个：
<ul>
<li>源头参数N（用来遍历生成结果的参数N，比如全排列中的字符串）</li>
<li>当前的结果的中间状态</li>
<li>跟中间状态对应的遍历下标i,表示当前循环正在处理的位置</li>
<li>跟N对应的boolean数组，判断对应下标元素是否被遍历过，这个数组在生成第一个元素前要重置（比如全排列9个字符，那么要主方法中要调用递归函数遍历9次，每次遍历都先重置这个数组)</li>
<li>保存结果的列表，递归中符合条件的结果直接添加到这个列表中</li>
</ul>
</li>
</ul>
<h2 id="3-shi-li-nhuang-hou-wen-ti">3 示例--N皇后问题</h2>
<p>问题描述：<br />
把N个皇后放在NxN的棋盘上，使其不能互相攻击（不在同一列，不在同一行，不在同一条斜线），给出所有符合条件的放置方法。经典的八皇后问题就是N=8的情况。</p>
<p>这里的数组的表示等按<a href="https://leetcode-cn.com/problems/n-queens/">Leetcode51题</a>。</p>
<p>按照<a href="https://www.fewth.com/hui-su-backtracking/#2-%E5%9F%BA%E6%9C%AC%E8%A6%81%E7%B4%A0">上面</a>提到的要素，我们先理一下思路：<br />
首先，每行和每列都只有一个皇后，这一点很容易保证。开始时我们在第一行中的不同位置尝试放置元素，后面的第2行。。。第n行也是如此，它们会判断当前列是否已经存在元素，是的话就返回，尝试下一列。这里的判断还要加上对角线，不难发现，是否在同一对角线可以用两点的横坐标差值是否和纵坐标差值相等（绝对值相等）来判断。</p>
<p><strong>这个问题本质上跟N个字符的全排列类似，只是把N个字符分散在N个字符串中，然后多了一个对角线判断</strong></p>
<p>根据上面的分析，我们先确定以下几个变量：</p>
<ul>
<li>记录棋盘中对应列是否已经放置了皇后：<code>boolean[N] isColUsed</code></li>
<li>结果的中间变量：<code>List&lt;String&gt; mid</code>，因为这里用String来表示一行</li>
<li>保存结果的变量:<code>List&lt;List&lt;String&gt;&gt; res</code></li>
</ul>
<p>题解如下：</p>
<pre style="background-color:#2b303b;">
<code class="language-java" data-lang="java"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Solution </span><span style="color:#eff1f5;">{
    </span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">&gt;&gt; </span><span style="color:#8fa1b3;">solveNQueens</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">n</span><span style="color:#eff1f5;">) {
        </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">&gt;&gt; res </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;&gt;();
        </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">&gt; mid </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">&lt;&gt;(); </span><span style="color:#65737e;">// 用于保存一个“棋谱”
        </span><span style="color:#b48ead;">for </span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;"> i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">; i </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#eff1f5;"> n; i</span><span style="color:#c0c5ce;">++</span><span style="color:#eff1f5;">) {
            mid.</span><span style="color:#bf616a;">clear</span><span style="color:#eff1f5;">(); </span><span style="color:#65737e;">// 重置棋谱
            </span><span style="color:#b48ead;">boolean[]</span><span style="color:#eff1f5;"> isColUsed </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new boolean</span><span style="color:#eff1f5;">[n]; </span><span style="color:#65737e;">// 初始化列的使用状态，表示对应的列是否已经被使用
</span><span style="color:#eff1f5;">            isColUsed[i] </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">true</span><span style="color:#eff1f5;">; </span><span style="color:#65737e;">// 下标i的列标记为已使用
            // 先添加每一行，并把每一行的下标i处的字符换为&#39;Q&#39;
</span><span style="color:#eff1f5;">            mid.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">StringBuilder</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">.</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">repeat</span><span style="color:#eff1f5;">(n </span><span style="color:#c0c5ce;">- </span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">)).</span><span style="color:#bf616a;">replace</span><span style="color:#eff1f5;">(i, i, </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">Q</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">).</span><span style="color:#bf616a;">toString</span><span style="color:#eff1f5;">());
            </span><span style="color:#bf616a;">backtrack</span><span style="color:#eff1f5;">(n, mid, isColUsed, res);
        }
        </span><span style="color:#b48ead;">return</span><span style="color:#eff1f5;"> res;
    }

    </span><span style="color:#65737e;">// 这里只传递mid，而没有传递当前处理的行的下标row，因为是从上往下遍历，我们所在的行row=mid.size()
    // 比如mid中保存01234这5行已经处理过的信息，那么说明我们正在处理下标为5的行（第6行）
    </span><span style="color:#b48ead;">public void </span><span style="color:#8fa1b3;">backtrack</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">n</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">mid</span><span style="color:#eff1f5;">, </span><span style="color:#b48ead;">boolean[] </span><span style="color:#bf616a;">isColUsed</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;">&gt;&gt; </span><span style="color:#bf616a;">res</span><span style="color:#eff1f5;">) {
        </span><span style="color:#65737e;">// 递归结束条件，表示我们已经遍历完所有行，注意n是一个越界的下标，如果这里不中止就出错了
        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(mid.</span><span style="color:#bf616a;">size</span><span style="color:#eff1f5;">() </span><span style="color:#c0c5ce;">==</span><span style="color:#eff1f5;"> n) {
            res.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">copyOf</span><span style="color:#eff1f5;">(mid)); </span><span style="color:#65737e;">// 这里必须用copyOf，直接添加mid的话，后续对mid的修改会影响res中的值
            </span><span style="color:#b48ead;">return</span><span style="color:#eff1f5;">;
        }

        </span><span style="color:#65737e;">// 剪枝，递归中断条件
</span><span style="color:#eff1f5;">        outerloop</span><span style="color:#c0c5ce;">:
        </span><span style="color:#b48ead;">for </span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;"> j </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">; j </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#eff1f5;"> n; j</span><span style="color:#c0c5ce;">++</span><span style="color:#eff1f5;">) {
            </span><span style="color:#65737e;">// 如果当前列已经被使用，则跳过循环
            </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(isColUsed[j] </span><span style="color:#c0c5ce;">== </span><span style="color:#d08770;">true</span><span style="color:#eff1f5;">) </span><span style="color:#b48ead;">continue</span><span style="color:#eff1f5;">;

            </span><span style="color:#65737e;">// 遍历mid中已经存在的String，得到&#39;Q&#39;的位置，确保后面添加的元素跟其不在一条对角线
            // 这个循环只是一个递归中断条件判断
            </span><span style="color:#b48ead;">for </span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;"> i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">; i </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#eff1f5;"> mid.</span><span style="color:#bf616a;">size</span><span style="color:#eff1f5;">(); i</span><span style="color:#c0c5ce;">++</span><span style="color:#eff1f5;">) {
                </span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;"> pos </span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;"> mid.</span><span style="color:#bf616a;">get</span><span style="color:#eff1f5;">(i).</span><span style="color:#bf616a;">indexOf</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&#39;</span><span style="color:#a3be8c;">Q</span><span style="color:#c0c5ce;">&#39;</span><span style="color:#eff1f5;">);
                </span><span style="color:#65737e;">// 判断是否在同一斜线，通过横向和竖向的坐标的差值的绝对值是否相等来判断
                </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Math</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">abs</span><span style="color:#eff1f5;">(mid.</span><span style="color:#bf616a;">size</span><span style="color:#eff1f5;">() </span><span style="color:#c0c5ce;">-</span><span style="color:#eff1f5;"> i) </span><span style="color:#c0c5ce;">== </span><span style="color:#ebcb8b;">Math</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">abs</span><span style="color:#eff1f5;">(pos </span><span style="color:#c0c5ce;">-</span><span style="color:#eff1f5;"> j)) </span><span style="color:#b48ead;">continue</span><span style="color:#eff1f5;"> outerloop;
            }

            </span><span style="color:#65737e;">// 能到这一步说明当前的列j是符合要求的，记录下这个状态(也就是包含列j的“半个棋谱”），等后面的递归调用处理完以后，删除列j，进入j+1循环（如果j+1列也符合要求，则也会来到这一步）
            // 这里用的是ArrayList,只需要移除最后一个元素即可恢复到上一个状态，所以不用另外记录
</span><span style="color:#eff1f5;">            mid.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">StringBuilder</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">.</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">repeat</span><span style="color:#eff1f5;">(n </span><span style="color:#c0c5ce;">- </span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">)).</span><span style="color:#bf616a;">replace</span><span style="color:#eff1f5;">(j, j, </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">Q</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">).</span><span style="color:#bf616a;">toString</span><span style="color:#eff1f5;">());
            </span><span style="color:#65737e;">// 记录递归前状态
</span><span style="color:#eff1f5;">            isColUsed[j] </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">true</span><span style="color:#eff1f5;">;

            </span><span style="color:#65737e;">// 调用递归，把过程棋谱和列的使用状态都传进去，这步调用的作用就是：
            // 在当前这个符合要求的棋谱状态的基础上，去把剩下的棋谱补全(所有符合要求的棋谱会在最里面这层循环调用时被添加到结果中，也就是前面的递归结束条件)
            </span><span style="color:#bf616a;">backtrack</span><span style="color:#eff1f5;">(n, mid, isColUsed, res);

            </span><span style="color:#65737e;">// 恢复递归前的状态
</span><span style="color:#eff1f5;">            isColUsed[j] </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">false</span><span style="color:#eff1f5;">; </span><span style="color:#65737e;">// 回退，取消该列的占位

            // 回退，移除最后一个元素，恢复到之前那个符合状态的棋谱状态
            // 这一步结束循环，说明包含当前层的列j的棋谱为基础的所有可能性都被遍历过，下一次就尝试当前层的列j+1
</span><span style="color:#eff1f5;">            mid.</span><span style="color:#bf616a;">remove</span><span style="color:#eff1f5;">(mid.</span><span style="color:#bf616a;">size</span><span style="color:#eff1f5;">() </span><span style="color:#c0c5ce;">- </span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">); 
        }
    }
}
</span></code></pre>
    </div>

    
    

    <div class="post-footer">
        
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;yong-github-actionszi-dong-hua-bu-shu-hexobo-ke-cong-si-you-cang-ku-dao-gong-gong-cang-ku&#x2F;">‹ 用Github-Actions自动化布署Hexo博客(从私有仓库到公共仓库)</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;www.fewth.com&#x2F;luayu-yan-ru-men&#x2F;">Lua语言入门 ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;www.fewth.com&#x2F;even.js" ></script>
      
    </body>

</html>
